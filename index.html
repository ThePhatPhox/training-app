<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2563eb">
  <title>Rob's Training</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
    .safe-top { padding-top: env(safe-area-inset-top); }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect, useRef } = React;

const STORAGE_KEY = 'training-log-v5';
const BUGS_KEY = 'training-bugs-v1';
const UPDATES_KEY = 'training-updates-v1';
const PROGRAM_START = new Date('2026-01-26');
const PROGRAM_END = new Date('2026-07-21');

const videoLinks = {
  "Shoulder dislocates": "https://www.youtube.com/results?search_query=shoulder+dislocates+pass+through+stick+tutorial",
  "Broomstick good morning": "https://www.youtube.com/results?search_query=broomstick+good+morning+stretch+tutorial",
  "Broomstick squat": "https://www.youtube.com/results?search_query=overhead+squat+mobility+broomstick+tutorial",
  "Broomstick twists": "https://www.youtube.com/results?search_query=broomstick+rotation+thoracic+twist+tutorial",
  "Broomstick side bends": "https://www.youtube.com/results?search_query=broomstick+side+bend+lateral+stretch",
  "Broomstick around the world": "https://www.youtube.com/results?search_query=broomstick+around+the+world+shoulder+mobility",
  "Arm twists": "https://www.youtube.com/results?search_query=arm+circles+warm+up+exercise",
  "Scapula dips": "https://www.youtube.com/watch?v=1AOk_LhHjsA",
  "Scapula press-ups": "https://www.youtube.com/watch?v=y4Wo095zPnc",
  "Scapula pull-downs": "https://www.youtube.com/watch?v=eSgqmaVsKT4",
  "Scapula pull-ups": "https://www.youtube.com/watch?v=VoqhOCR6dkQ",
  "Leg Press": "https://www.youtube.com/watch?v=IZxyjW7MPJQ",
  "Converging Chest Press": "https://www.youtube.com/watch?v=xUm0BiZCWlQ",
  "Lat Pulldown": "https://www.youtube.com/watch?v=CAwf7n6Luuc",
  "Barbell Romanian Deadlift": "https://www.youtube.com/watch?v=7AaaYhMqTws",
  "Cable Lateral Raise": "https://www.youtube.com/watch?v=PPrzBWZDOhA",
  "Incline Dumbbell Curl": "https://www.youtube.com/watch?v=soxrZlIl35U",
  "Reverse Pec Deck": "https://www.youtube.com/watch?v=5YK4bgzXDp0",
  "Chest-Supported Row": "https://www.youtube.com/watch?v=H75im9fAUMc",
  "Incline Dumbbell Press": "https://www.youtube.com/watch?v=8iPEnn-ltC8",
  "Barbell Hip Thrust": "https://www.youtube.com/watch?v=LM8XHLYJoYs",
  "Bulgarian Split Squat": "https://www.youtube.com/watch?v=2C-uNgKwPLE",
  "Barbell Skull Crusher": "https://www.youtube.com/watch?v=d_KZxkY_0cM",
  "High Incline Shrugs": "https://www.youtube.com/watch?v=dj3r9xisP_E",
  "Cable Crunches": "https://www.youtube.com/watch?v=AV5PmZJIrrw",
  "Cable crunches": "https://www.youtube.com/watch?v=AV5PmZJIrrw",
  "Cable Woodchops": "https://www.youtube.com/watch?v=pAplQXk3dkU",
  "Cable woodchops": "https://www.youtube.com/watch?v=pAplQXk3dkU",
  "Leg raises": "https://www.youtube.com/watch?v=JB2oyawG9KI",
  "Hanging leg raises": "https://www.youtube.com/watch?v=hdng3Nm1x_E",
  "Side plank (left)": "https://www.youtube.com/watch?v=K2VljzCC16g",
  "Side plank (right)": "https://www.youtube.com/watch?v=K2VljzCC16g",
  "Russian twists": "https://www.youtube.com/watch?v=wkD8rjkodUI",
  "Russian twists (KB)": "https://www.youtube.com/watch?v=wkD8rjkodUI",
  "A: Clamshells / B: Banded walks": "https://www.youtube.com/watch?v=cD8TC_boFPo",
  "A: Fire hydrants / B: SL glute bridge": "https://www.youtube.com/watch?v=La3xYT8MGks",
  "A: Glute bridges / B: Donkey kicks": "https://www.youtube.com/watch?v=OUgsJ8-Vi0E",
  "Isometric ball extension (left)": "https://www.youtube.com/results?search_query=glute+med+isometric+ball+wall+exercise",
  "Isometric ball extension (right)": "https://www.youtube.com/results?search_query=glute+med+isometric+ball+wall+exercise",
  "Swiss ball leg curl (both)": "https://www.youtube.com/results?search_query=swiss+ball+hamstring+curl+tutorial",
  "Swiss ball leg curl (left)": "https://www.youtube.com/results?search_query=single+leg+swiss+ball+hamstring+curl",
  "Swiss ball leg curl (right)": "https://www.youtube.com/results?search_query=single+leg+swiss+ball+hamstring+curl",
  "DB single leg RDL (left)": "https://www.youtube.com/results?search_query=single+leg+dumbbell+rdl+same+side+tutorial",
  "DB single leg RDL (right)": "https://www.youtube.com/results?search_query=single+leg+dumbbell+rdl+same+side+tutorial",
  "Single leg hip thrust (left)": "https://www.youtube.com/results?search_query=single+leg+hip+thrust+tutorial",
  "Single leg hip thrust (right)": "https://www.youtube.com/results?search_query=single+leg+hip+thrust+tutorial",
  "Inchworms": "https://www.youtube.com/results?search_query=inchworm+exercise+tutorial",
  "Figure 4 stretch (left)": "https://www.youtube.com/results?search_query=figure+4+piriformis+stretch",
  "Figure 4 stretch (right)": "https://www.youtube.com/results?search_query=figure+4+piriformis+stretch",
  "Sidestep miniband": "https://www.youtube.com/results?search_query=miniband+sidestep+glute+med",
  "Side-lying quad stretch (left)": "https://www.youtube.com/results?search_query=side+lying+quad+stretch",
  "Side-lying quad stretch (right)": "https://www.youtube.com/results?search_query=side+lying+quad+stretch",
  "Parallette dips": "https://www.youtube.com/results?search_query=parallette+dips+tutorial",
  "Wall sit": "https://www.youtube.com/watch?v=y-wV4Lz-g-4",
  "A: Wall sit / B: Handgrip": "https://www.youtube.com/watch?v=y-wV4Lz-g-4",
  "A: SL wall sit / B: Plank": "https://www.youtube.com/watch?v=y-wV4Lz-g-4",
  "KB swings": "https://www.youtube.com/watch?v=YSxHifyI6s8",
  "Turkish get-up (left)": "https://www.youtube.com/watch?v=0bWRPC49-KI",
  "Turkish get-up (right)": "https://www.youtube.com/watch?v=0bWRPC49-KI",
  "Active hang": "https://www.youtube.com/watch?v=HoE-C85ZlCE",
  "Passive hang": "https://www.youtube.com/watch?v=HoE-C85ZlCE",
  "Hip abductor machine": "https://www.youtube.com/watch?v=FoEGVh49bck",
  "Hip adductor machine": "https://www.youtube.com/watch?v=oMfZhG-wRjk",
  "Cable pull-throughs": "https://www.youtube.com/watch?v=ArPyMgdGaQY",
  "Hip flexor stretch (left)": "https://www.youtube.com/watch?v=YQmpO9VT2X4",
  "Hip flexor stretch (right)": "https://www.youtube.com/watch?v=YQmpO9VT2X4",
};

const formatDate = (date) => date.toISOString().split('T')[0];
const parseDate = (str) => new Date(str + 'T00:00:00');
const getDayOfWeek = (date) => ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][date.getDay()];
const getWeekNumber = (date) => { const diff = date - PROGRAM_START; return Math.floor(diff / (1000 * 60 * 60 * 24 * 7)) + 1; };
const getCycleDay = (date) => { const diff = date - PROGRAM_START; return (Math.floor(diff / (1000 * 60 * 60 * 24)) % 14) + 1; };
const getAcclimatisationPhase = (date) => { const w = getWeekNumber(date); return w <= 2 ? 1 : w <= 4 ? 2 : 0; };
const getPhaseLabel = (p) => p === 1 ? "ğŸŒ± Phase 1: Just Show Up" : p === 2 ? "ğŸ“ˆ Phase 2: Building Back" : "ğŸ’ª Full Program";
const getWeekType = (date) => getWeekNumber(date) % 2 === 1 ? 'A' : 'B';
const getSession = (date) => {
  const d = getDayOfWeek(date), w = getWeekType(date);
  const B = { 'Sat': 'gymRecoveryWeekend', 'Sun': 'rest', 'Mon': 'gymDay1', 'Tue': 'gymDay2', 'Wed': 'homeFull', 'Thu': 'gymRecoveryWeekday', 'Fri': 'homeFull' };
  const A = { 'Sat': 'gymRecoveryWeekend', 'Sun': 'rest', 'Mon': 'homeFull', 'Tue': 'gymDay1', 'Wed': 'homeLight', 'Thu': 'gymDay2', 'Fri': 'homeFull' };
  return w === 'A' ? A[d] : B[d];
};
const getCustody = (date) => {
  const d = getDayOfWeek(date), w = getWeekType(date);
  const B = { 'Mon': 'mum', 'Tue': 'mum', 'Wed': 'dad', 'Thu': 'mum', 'Fri': 'dad', 'Sat': 'dad', 'Sun': 'dad' };
  const A = { 'Mon': 'dad', 'Tue': 'mum', 'Wed': 'dad', 'Thu': 'mum', 'Fri': 'dad', 'Sat': 'mum', 'Sun': 'mum' };
  return (w === 'A' ? A[d] : B[d]) === 'dad' ? 'Boys with dad' : "Boys at mum's";
};
const getCardioMachine = (date) => {
  const d = getDayOfWeek(date), w = getWeekType(date);
  const B = { 'Sat': 'Rowing', 'Mon': 'Elliptical', 'Tue': 'Ski-erg', 'Thu': 'Cycling' };
  const A = { 'Sat': 'Ski-erg', 'Tue': 'Rowing', 'Thu': 'Elliptical' };
  return w === 'A' ? A[d] : B[d];
};
const getShowGlutes = (date) => { const p = getAcclimatisationPhase(date), s = getSession(date), d = getDayOfWeek(date); return p === 1 ? s === 'rest' : s === 'rest' || d === 'Wed'; };
const getShowTGU = (date) => { const d = getDayOfWeek(date), w = getWeekType(date), s = getSession(date); return s === 'gymRecoveryWeekend' || (s === 'homeFull' && d === 'Wed' && w === 'A') || (s === 'homeFull' && d === 'Fri' && w === 'B'); };

const calisthenicsRotation = {
  1: { focus: "Chest", exercises: [{ name: "Knee push up", reps: "3 Ã— 6-12", mins: 4, inApp: true }, { name: "Bench dip", reps: "3 Ã— 6-12", mins: 4, inApp: true }]},
  2: { focus: "Back", exercises: [{ name: "Superman pulses", reps: "3 Ã— 10-20", mins: 4, inApp: true }, { name: "Towel row", reps: "3 Ã— 8-15", mins: 4, inApp: true }]},
  3: { focus: "Legs", exercises: [{ name: "Bench squat", reps: "3 Ã— 8-15", mins: 4, inApp: true }, { name: "Alternating lunge", reps: "3 Ã— 10-20", mins: 4, inApp: true }]},
  4: { focus: "Shoulders", exercises: [{ name: "Incline pike push up", reps: "3 Ã— 6-12", mins: 4, inApp: true }, { name: "Pike shoulder taps", reps: "3 Ã— 10-20", mins: 4, inApp: true }]},
  5: { focus: "Arms", exercises: [{ name: "Knee tricep extensions", reps: "3 Ã— 6-12", mins: 4, inApp: true }, { name: "Banded bicep curls", reps: "3 Ã— 6-12", mins: 4, inApp: true }]},
  6: { focus: "Abs/Core", exercises: [{ name: "Elbow plank", reps: "3 Ã— 20-40 sec", mins: 3, inApp: true }, { name: "Alternating single leg kickouts", reps: "3 Ã— 10-20", mins: 4, inApp: true }]},
  7: { focus: "Mobility", exercises: [{ name: "Cat to cow", reps: "3 Ã— 6-12", mins: 3, inApp: true }, { name: "Downward facing dog", reps: "3 Ã— 15-30 sec", mins: 3, inApp: true }]},
  8: { focus: "Chest", exercises: [{ name: "Push up", reps: "3 Ã— 6-12", mins: 4, inApp: true }, { name: "Elevated bench dips", reps: "3 Ã— 6-12", mins: 4, inApp: true }]},
  9: { focus: "Back", exercises: [{ name: "Table rows", reps: "3 Ã— 6-12", mins: 4, inApp: true }, { name: "Y-wall stretch", reps: "3 Ã— 10-20", mins: 3, inApp: true }]},
  10: { focus: "Legs", exercises: [{ name: "Squat", reps: "3 Ã— 8-15", mins: 4, inApp: true }, { name: "Alternating side lunge", reps: "3 Ã— 10-20", mins: 4, inApp: true }]},
  11: { focus: "Shoulders", exercises: [{ name: "Pike push up", reps: "3 Ã— 5-10", mins: 4, inApp: true }, { name: "Plank to pike walks", reps: "3 Ã— 4-8", mins: 4, inApp: true }]},
  12: { focus: "Arms", exercises: [{ name: "Banded bicep curls", reps: "3 Ã— 6-12", mins: 4, inApp: true }, { name: "Floor tricep extension", reps: "3 Ã— 5-10", mins: 4, inApp: true }]},
  13: { focus: "Abs/Core", exercises: [{ name: "Hollow body hold", reps: "3 Ã— 20-45 sec", mins: 3, inApp: true }, { name: "Superman hold", reps: "3 Ã— 30-60 sec", mins: 3, inApp: true }]},
  14: { focus: "Mobility", exercises: [{ name: "Pigeon pose (L)", reps: "3 Ã— 15-30s", mins: 2, inApp: true }, { name: "Pigeon pose (R)", reps: "3 Ã— 15-30s", mins: 2, inApp: true }, { name: "Camel pose", reps: "3 Ã— 20-40s", mins: 2, inApp: true }]}
};

const strengthExercises = ['Leg Press', 'Converging Chest Press', 'Lat Pulldown', 'Barbell Romanian Deadlift', 'Cable Lateral Raise', 'Incline Dumbbell Curl', 'Reverse Pec Deck', 'Chest-Supported Row', 'Incline Dumbbell Press', 'Barbell Hip Thrust', 'Bulgarian Split Squat', 'Barbell Skull Crusher', 'High Incline Shrugs'];

const modifyExerciseForPhase = (ex, phase) => {
  if (phase === 0) return ex;
  const m = { ...ex };
  if (strengthExercises.includes(ex.name)) { m.reps = phase === 1 ? "1 Ã— 3 (very light)" : "1 Ã— 6-8"; m.mins = phase === 1 ? 1 : 3; return m; }
  if (ex.name.includes('Turkish get-up')) { m.reps = phase === 1 ? "3 reps (bodyweight)" : "3 reps (light)"; m.trackWeight = phase !== 1; m.mins = phase === 1 ? 2 : 3; return m; }
  if (ex.name === 'KB swings') { m.reps = phase === 1 ? "1 Ã— 10 (light)" : "2 Ã— 15"; m.mins = phase === 1 ? 1 : 3; return m; }
  if (ex.name === 'Wall sit') { m.reps = phase === 1 ? "1 Ã— 1 min" : phase === 2 ? "2 Ã— 1 min" : "2 Ã— 2 min"; m.mins = phase === 1 ? 1 : phase === 2 ? 2 : 4; return m; }
  if (ex.name === 'SL wall sit') { m.reps = phase === 1 ? "1 Ã— 30s each" : phase === 2 ? "1 Ã— 45s each" : "2 Ã— 30s each"; m.mins = 1; return m; }
  if (ex.name === 'Handgrip') { m.reps = phase === 1 ? "1 Ã— 1 min each" : phase === 2 ? "2 Ã— 1 min each" : "4 Ã— 2 min each"; m.mins = phase === 1 ? 2 : phase === 2 ? 4 : 8; return m; }
  if (ex.name === 'Plank') { m.reps = phase === 1 ? "1 Ã— 20s" : phase === 2 ? "1 Ã— 30s" : "1 Ã— 45s"; m.mins = 1; return m; }
  if (ex.name.includes('Scapula') && phase === 1) { m.reps = m.reps.replace(/2 Ã—/g, '1 Ã—'); return m; }
  if (ex.name.includes('stretch') || ex.name.includes('Stretch')) { m.reps = phase === 1 ? m.reps.replace(/60 sec/g, '20 sec').replace(/2 min/g, '30 sec') : m.reps.replace(/60 sec/g, '45 sec').replace(/2 min/g, '90 sec'); m.mins = phase === 1 ? 1 : 1; return m; }
  if (ex.name.includes('Hip abductor') || ex.name.includes('Hip adductor') || ex.name.includes('Cable pull-through')) { m.reps = phase === 1 ? "1 Ã— 12 (light)" : "2 Ã— 12"; m.mins = phase === 1 ? 1 : 3; return m; }
  if (ex.name === 'Active hang') { m.reps = phase === 1 ? "1 Ã— 10 sec" : "1 Ã— max"; m.trackTime = phase !== 1; m.mins = 1; return m; }
  if (ex.name === 'Passive hang') { m.reps = phase === 1 ? "1 Ã— 15 sec" : "1 Ã— 20 sec"; m.mins = 1; return m; }
  if (ex.name.includes('Cable crunch') || ex.name.includes('Cable woodchop') || ex.name.includes('Leg raises') || ex.name.includes('Hanging leg raises') || ex.name.includes('Side plank') || ex.name.includes('Russian twist')) { m.reps = phase === 1 ? m.reps.replace(/2 Ã—/g, '1 Ã—') : m.reps; m.mins = phase === 1 ? 1 : 2; return m; }
  if (ex.name === 'Skipping') { m.reps = phase === 1 ? "3 min" : "5 min"; m.mins = phase === 1 ? 3 : 5; return m; }
  if (ex.name.includes('Machine cardio') || ex.name === 'Rowing' || ex.name === 'Elliptical' || ex.name === 'Ski-erg' || ex.name === 'Cycling') { m.reps = phase === 1 ? "10 min Zone 2" : "15 min Zone 2"; m.mins = phase === 1 ? 10 : 15; return m; }
  return m;
};

const trainingData = {
  gymDay1: { title: "ğŸ‹ï¸ GYM Day 1", time: "~120 min", timePhase1: "~70 min", timePhase2: "~100 min", sections: [
    { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true, protected: true },
    { name: "Quick Prep (5 min)", exercises: [{ name: "Bridges", reps: "1 Ã— 10", mins: 2 }, { name: "Inchworms", reps: "1 Ã— 8", mins: 2 }, { name: "Arm circles", reps: "20 each", mins: 1 }]},
    { name: "Travel (10 min)", exercises: [{ name: "Walk or jog to gym", reps: "", mins: 10 }] },
    { name: "Cardio (20 min)", exercises: [{ name: "Skipping", reps: "5 min", mins: 5 }, { name: "Machine cardio (rotate)", reps: "15 min Zone 2", mins: 15 }]},
    { name: "Strength - 2-2-2", exercises: [{ name: "Leg Press", reps: "2 Ã— 6-8", trackWeight: true, mins: 4 }, { name: "Converging Chest Press", reps: "2 Ã— 6-10", trackWeight: true, mins: 4 }, { name: "Lat Pulldown", reps: "2 Ã— 6-10", trackWeight: true, mins: 4 }, { name: "Barbell Romanian Deadlift", reps: "2 Ã— 6-10", trackWeight: true, mins: 4 }, { name: "Cable Lateral Raise", reps: "2 Ã— 10-12", trackWeight: true, mins: 3 }, { name: "Incline Dumbbell Curl", reps: "2 Ã— 8-12", trackWeight: true, mins: 3 }, { name: "Reverse Pec Deck", reps: "2 Ã— 10-12", trackWeight: true, mins: 3 }]},
    { name: "Core", exercises: [{ name: "Cable Crunches", reps: "2 Ã— 12-15", trackWeight: true, mins: 3 }, { name: "Cable Woodchops", reps: "2 Ã— 10 each", trackWeight: true, mins: 3 }], protected: true },
    { name: "Travel Home (10 min)", exercises: [{ name: "Walk or jog", reps: "", mins: 10 }] },
    { name: "Isometrics (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4Ã—2min / 4Ã—2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2Ã—30s ea / 1Ã—45s", mins: 3 }]},
    { name: "Close (5 min)", exercises: [{ name: "Active hang", reps: "1 Ã— max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 Ã— 20 sec", mins: 1 }, { name: "Scapula dips", reps: "1 Ã— 10", mins: 2 }]}
  ]},
  gymDay2: { title: "ğŸ‹ï¸ GYM Day 2", time: "~120 min", timePhase1: "~70 min", timePhase2: "~100 min", sections: [
    { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true, protected: true },
    { name: "Quick Prep (5 min)", exercises: [{ name: "Bridges", reps: "1 Ã— 10", mins: 2 }, { name: "Inchworms", reps: "1 Ã— 8", mins: 2 }, { name: "Arm circles", reps: "20 each", mins: 1 }]},
    { name: "Travel (10 min)", exercises: [{ name: "Walk or jog to gym", reps: "", mins: 10 }] },
    { name: "Cardio (20 min)", exercises: [{ name: "Skipping", reps: "5 min", mins: 5 }, { name: "Machine cardio (rotate)", reps: "15 min Zone 2", mins: 15 }]},
    { name: "Strength - 2-2-2", exercises: [{ name: "Chest-Supported Row", reps: "2 Ã— 6-10", trackWeight: true, mins: 4 }, { name: "Incline Dumbbell Press", reps: "2 Ã— 6-10", trackWeight: true, mins: 4 }, { name: "Barbell Hip Thrust", reps: "2 Ã— 6-10", trackWeight: true, mins: 4 }, { name: "Bulgarian Split Squat", reps: "2 Ã— 6-10", trackWeight: true, mins: 4 }, { name: "Cable Lateral Raise", reps: "2 Ã— 10-12", trackWeight: true, mins: 3 }, { name: "Barbell Skull Crusher", reps: "2 Ã— 8-12", trackWeight: true, mins: 3 }, { name: "High Incline Shrugs", reps: "2 Ã— 8-12", trackWeight: true, mins: 3 }]},
    { name: "Core", exercises: [{ name: "Cable Crunches", reps: "2 Ã— 12-15", trackWeight: true, mins: 3 }, { name: "Cable Woodchops", reps: "2 Ã— 10 each", trackWeight: true, mins: 3 }], protected: true },
    { name: "Travel Home (10 min)", exercises: [{ name: "Walk or jog", reps: "", mins: 10 }] },
    { name: "Isometrics (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4Ã—2min / 4Ã—2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2Ã—30s ea / 1Ã—45s", mins: 3 }]},
    { name: "Close (5 min)", exercises: [{ name: "Active hang", reps: "1 Ã— max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 Ã— 20 sec", mins: 1 }, { name: "Scapula dips", reps: "1 Ã— 10", mins: 2 }]}
  ]},
  gymRecoveryWeekend: { title: "ğŸ‹ï¸ GYM Recovery WEEKEND", time: "~145 min", timePhase1: "~80 min", timePhase2: "~120 min", sections: [
    { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true, protected: true },
    { name: "Travel (10 min)", exercises: [{ name: "Walk or jog to gym", reps: "", mins: 10 }] },
    { name: "Warm-up (10 min)", exercises: [{ name: "Bridges", reps: "1 Ã— 10", mins: 2 }, { name: "Inchworms", reps: "1 Ã— 8", mins: 2 }, { name: "Shoulder dislocates", reps: "1 Ã— 10", mins: 1 }, { name: "Broomstick good morning", reps: "1 Ã— 10", mins: 1 }, { name: "Broomstick squat", reps: "1 Ã— 10", mins: 1 }, { name: "Broomstick twists", reps: "1 Ã— 10 each", mins: 1 }, { name: "Broomstick side bends", reps: "1 Ã— 10 each", mins: 1 }, { name: "Broomstick around the world", reps: "1 Ã— 5 each", mins: 1 }, { name: "Arm twists", reps: "1 Ã— 10 each way", mins: 1 }, { name: "Bend mobility flow", reps: "5 min", mins: 5, inApp: true }]},
    { name: "Cardio (30 min)", exercises: [{ name: "Incline walk", reps: "15 min Zone 2", mins: 15 }, { name: "Machine cardio (rotate)", reps: "15 min Zone 2", mins: 15 }]},
    { name: "Scapula Work", exercises: [{ name: "Scapula dips", reps: "2 Ã— 10", mins: 3 }, { name: "Scapula press-ups", reps: "2 Ã— 10", mins: 3 }, { name: "Scapula pull-downs", reps: "2 Ã— 10", mins: 3 }, { name: "Scapula pull-ups", reps: "2 Ã— 5", mins: 3 }]},
    { name: "Core", exercises: [{ name: "Cable crunches", reps: "2 Ã— 12-15", trackWeight: true, mins: 3 }, { name: "Cable woodchops", reps: "2 Ã— 10 each", trackWeight: true, mins: 3 }, { name: "Side plank (left)", reps: "1 Ã— 30 sec", mins: 1 }, { name: "Side plank (right)", reps: "1 Ã— 30 sec", mins: 1 }, { name: "Russian twists", reps: "2 Ã— 10 each", mins: 2 }], protected: true },
    { name: "Glutes/Hips", exercises: [{ name: "Hip abductor machine", reps: "2 Ã— 15", trackWeight: true, mins: 3 }, { name: "Hip adductor machine", reps: "2 Ã— 15", trackWeight: true, mins: 3 }, { name: "Cable pull-throughs", reps: "2 Ã— 12", trackWeight: true, mins: 3 }]},
    { name: "Isometrics", exercises: [{ name: "Wall sit", reps: "2 Ã— 2 min", mins: 5 }] },
    { name: "Strength", exercises: [{ name: "Turkish get-up (left)", reps: "1 rep", trackWeight: true, mins: 3 }, { name: "Turkish get-up (right)", reps: "1 rep", trackWeight: true, mins: 3 }]},
    { name: "Close", exercises: [{ name: "Active hang", reps: "1 Ã— max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 Ã— 20 sec", mins: 1 }]},
    { name: "Stretch", exercises: [{ name: "Hip flexor stretch (left)", reps: "2 min", mins: 2 }, { name: "Hip flexor stretch (right)", reps: "2 min", mins: 2 }, { name: "Figure 4 stretch (left)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Figure 4 stretch (right)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Side-lying quad stretch (left)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Side-lying quad stretch (right)", reps: "1 Ã— 60 sec", mins: 1 }]},
    { name: "Travel Home (10 min)", exercises: [{ name: "Walk or jog", reps: "", mins: 10 }] }
  ]},
  gymRecoveryWeekday: { title: "ğŸ‹ï¸ GYM Recovery WEEKDAY", time: "~115 min", timePhase1: "~70 min", timePhase2: "~100 min", sections: [
    { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true, protected: true },
    { name: "Travel (10 min)", exercises: [{ name: "Walk or jog to gym", reps: "", mins: 10 }] },
    { name: "Warm-up", exercises: [{ name: "Bridges", reps: "1 Ã— 10", mins: 2 }, { name: "Inchworms", reps: "1 Ã— 8", mins: 2 }]},
    { name: "Cardio (25 min)", exercises: [{ name: "Incline walk", reps: "15 min Zone 2", mins: 15 }, { name: "Machine cardio (rotate)", reps: "10 min Zone 2", mins: 10 }]},
    { name: "Core", exercises: [{ name: "Cable crunches", reps: "2 Ã— 12-15", trackWeight: true, mins: 3 }, { name: "Cable woodchops", reps: "2 Ã— 10 each", trackWeight: true, mins: 3 }], protected: true },
    { name: "Glutes/Hips", exercises: [{ name: "Hip abductor machine", reps: "2 Ã— 15", trackWeight: true, mins: 3 }, { name: "Hip adductor machine", reps: "2 Ã— 15", trackWeight: true, mins: 3 }]},
    { name: "Isometrics", exercises: [{ name: "Wall sit", reps: "2 Ã— 2 min", mins: 5 }] },
    { name: "Close", exercises: [{ name: "Active hang", reps: "1 Ã— max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 Ã— 20 sec", mins: 1 }]},
    { name: "Travel Home (10 min)", exercises: [{ name: "Walk or jog", reps: "", mins: 10 }] }
  ]},
  homeFull: { title: "ğŸ  HOME Full", time: "~115 min", timePhase1: "~55 min", timePhase2: "~90 min", sections: [
    { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true, protected: true },
    { name: "OPEN (10 min)", exercises: [{ name: "Bridges", reps: "1 Ã— 10", mins: 2 }, { name: "Inchworms", reps: "1 Ã— 8", mins: 2 }, { name: "Shoulder dislocates", reps: "1 Ã— 10", mins: 1 }, { name: "Broomstick good morning", reps: "1 Ã— 10", mins: 1 }, { name: "Broomstick squat", reps: "1 Ã— 10", mins: 1 }, { name: "Broomstick twists", reps: "1 Ã— 10 each", mins: 1 }, { name: "Broomstick side bends", reps: "1 Ã— 10 each", mins: 1 }, { name: "Broomstick around the world", reps: "1 Ã— 5 each", mins: 1 }, { name: "Arm twists", reps: "1 Ã— 10 each way", mins: 1 }, { name: "Bend mobility flow", reps: "5 min", mins: 5, inApp: true }]},
    { name: "Glutes & Physio (A/B)", isConditionalGlutes: true, exercises: [{ name: "A: Clamshells / B: Banded walks", reps: "1Ã—15 ea / 1Ã—20", mins: 3 }, { name: "A: Fire hydrants / B: SL glute bridge", reps: "1Ã—15 ea / 1Ã—10 ea", mins: 3 }, { name: "A: Glute bridges / B: Donkey kicks", reps: "1Ã—15 / 1Ã—15 ea", mins: 3 }, { name: "Sidestep miniband", reps: "2 Ã— 20 steps", mins: 3 }, { name: "Isometric ball extension (left)", reps: "3 Ã— 30 sec", mins: 2 }, { name: "Isometric ball extension (right)", reps: "3 Ã— 30 sec", mins: 2 }, { name: "Swiss ball leg curl (both)", reps: "2 Ã— 10", mins: 3 }, { name: "Swiss ball leg curl (left)", reps: "1 Ã— 8", mins: 2 }, { name: "Swiss ball leg curl (right)", reps: "1 Ã— 8", mins: 2 }, { name: "Single leg hip thrust (left)", reps: "1 Ã— 10", mins: 2 }, { name: "Single leg hip thrust (right)", reps: "1 Ã— 10", mins: 2 }, { name: "DB single leg RDL (left)", reps: "1 Ã— 8", trackWeight: true, mins: 2 }, { name: "DB single leg RDL (right)", reps: "1 Ã— 8", trackWeight: true, mins: 2 }]},
    { name: "Isometrics (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4Ã—2min / 4Ã—2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2Ã—30s ea / 1Ã—45s", mins: 3 }]},
    { name: "Main", exercises: [{ name: "KB swings", reps: "2 Ã— 20", trackWeight: true, mins: 4 }, { name: "Turkish get-up (left)", reps: "1 rep", trackWeight: true, isConditionalTGU: true, mins: 3 }, { name: "Turkish get-up (right)", reps: "1 rep", trackWeight: true, isConditionalTGU: true, mins: 3 }, { name: "Parallette dips", reps: "2 Ã— 8", mins: 3 }, { name: "Punch bag", reps: "5 min", mins: 5 }]},
    { name: "Core", exercises: [{ name: "Leg raises", reps: "2 Ã— 10", mins: 3 }, { name: "Hanging leg raises", reps: "2 Ã— 8", mins: 3 }, { name: "Side plank (left)", reps: "1 Ã— 30 sec", mins: 1 }, { name: "Side plank (right)", reps: "1 Ã— 30 sec", mins: 1 }, { name: "Russian twists (KB)", reps: "2 Ã— 10 each", trackWeight: true, mins: 3 }], protected: true },
    { name: "Stretch", exercises: [{ name: "Figure 4 stretch (left)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Figure 4 stretch (right)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Side-lying quad stretch (left)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Side-lying quad stretch (right)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Active hang", reps: "1 Ã— max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 Ã— 20 sec", mins: 1 }]}
  ]},
  homeLight: { title: "ğŸ  HOME Light", time: "~95 min", timePhase1: "~50 min", timePhase2: "~85 min", sections: [
    { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true, protected: true },
    { name: "OPEN", exercises: [{ name: "Bridges", reps: "1 Ã— 10", mins: 2 }, { name: "Inchworms", reps: "1 Ã— 8", mins: 2 }, { name: "Bend mobility flow", reps: "5 min", mins: 5, inApp: true }]},
    { name: "Glutes & Physio (A/B)", isConditionalGlutes: true, exercises: [{ name: "A: Clamshells / B: Banded walks", reps: "1Ã—15 ea / 1Ã—20", mins: 3 }, { name: "A: Fire hydrants / B: SL glute bridge", reps: "1Ã—15 ea / 1Ã—10 ea", mins: 3 }, { name: "A: Glute bridges / B: Donkey kicks", reps: "1Ã—15 / 1Ã—15 ea", mins: 3 }, { name: "Sidestep miniband", reps: "2 Ã— 20 steps", mins: 3 }, { name: "Isometric ball extension (left)", reps: "3 Ã— 30 sec", mins: 2 }, { name: "Isometric ball extension (right)", reps: "3 Ã— 30 sec", mins: 2 }, { name: "Swiss ball leg curl (both)", reps: "2 Ã— 10", mins: 3 }, { name: "Swiss ball leg curl (left)", reps: "1 Ã— 8", mins: 2 }, { name: "Swiss ball leg curl (right)", reps: "1 Ã— 8", mins: 2 }, { name: "Single leg hip thrust (left)", reps: "1 Ã— 10", mins: 2 }, { name: "Single leg hip thrust (right)", reps: "1 Ã— 10", mins: 2 }, { name: "DB single leg RDL (left)", reps: "1 Ã— 8", trackWeight: true, mins: 2 }, { name: "DB single leg RDL (right)", reps: "1 Ã— 8", trackWeight: true, mins: 2 }]},
    { name: "Main", exercises: [{ name: "KB swings", reps: "2 Ã— 20", trackWeight: true, mins: 4 }, { name: "Parallette dips", reps: "2 Ã— 8", mins: 3 }]},
    { name: "Isometrics (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4Ã—2min / 4Ã—2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2Ã—30s ea / 1Ã—45s", mins: 3 }]},
    { name: "Stretch", exercises: [{ name: "Figure 4 stretch (left)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Figure 4 stretch (right)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Side-lying quad stretch (left)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Side-lying quad stretch (right)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Active hang", reps: "1 Ã— max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 Ã— 20 sec", mins: 1 }]}
  ]},
  rest: { title: "ğŸ˜´ REST Day", time: "~105 min", timePhase1: "~55 min", timePhase2: "~90 min", sections: [
    { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true, protected: true },
    { name: "Warm-up", exercises: [{ name: "Bridges", reps: "1 Ã— 10", mins: 2 }, { name: "Inchworms", reps: "1 Ã— 8", mins: 2 }]},
    { name: "Recovery", exercises: [{ name: "Bend mobility flow", reps: "15 min", mins: 15, inApp: true }] },
    { name: "Glutes & Physio (A/B)", isConditionalGlutes: true, exercises: [{ name: "A: Clamshells / B: Banded walks", reps: "1Ã—15 ea / 1Ã—20", mins: 3 }, { name: "A: Fire hydrants / B: SL glute bridge", reps: "1Ã—15 ea / 1Ã—10 ea", mins: 3 }, { name: "A: Glute bridges / B: Donkey kicks", reps: "1Ã—15 / 1Ã—15 ea", mins: 3 }, { name: "Sidestep miniband", reps: "2 Ã— 20 steps", mins: 3 }, { name: "Isometric ball extension (left)", reps: "3 Ã— 30 sec", mins: 2 }, { name: "Isometric ball extension (right)", reps: "3 Ã— 30 sec", mins: 2 }, { name: "Swiss ball leg curl (both)", reps: "2 Ã— 10", mins: 3 }, { name: "Swiss ball leg curl (left)", reps: "1 Ã— 8", mins: 2 }, { name: "Swiss ball leg curl (right)", reps: "1 Ã— 8", mins: 2 }, { name: "Single leg hip thrust (left)", reps: "1 Ã— 10", mins: 2 }, { name: "Single leg hip thrust (right)", reps: "1 Ã— 10", mins: 2 }, { name: "DB single leg RDL (left)", reps: "1 Ã— 8", trackWeight: true, mins: 2 }, { name: "DB single leg RDL (right)", reps: "1 Ã— 8", trackWeight: true, mins: 2 }]},
    { name: "Isometrics (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4Ã—2min / 4Ã—2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2Ã—30s ea / 1Ã—45s", mins: 3 }]},
    { name: "Stretch", exercises: [{ name: "Figure 4 stretch (left)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Figure 4 stretch (right)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Side-lying quad stretch (left)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Side-lying quad stretch (right)", reps: "1 Ã— 60 sec", mins: 1 }, { name: "Active hang", reps: "1 Ã— max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 Ã— 20 sec", mins: 1 }]}
  ]}
};

const dailyNonNegotiablesBase = [{ name: "Power walk", mins: 30, minsP1: 20 }, { name: "Breathing (5s in, 5s out)", mins: 5, minsP1: 3 }, { name: "Vagus: Cold shower / Humming / Gargling", mins: 2, minsP1: 2 }];
const getDailyNonNegotiables = (phase) => dailyNonNegotiablesBase.map(d => ({ name: phase === 1 ? `${d.minsP1}-min ${d.name}` : `${d.mins}-min ${d.name}`, mins: phase === 1 ? d.minsP1 : d.mins }));

const VideoLink = ({ name }) => { const url = videoLinks[name]; return url ? <a href={url} target="_blank" rel="noopener noreferrer" className="text-blue-500 ml-1" onClick={(e) => e.stopPropagation()}>ğŸ“¹</a> : null; };
const AppBadge = () => <span className="text-green-600 text-xs ml-1">ğŸ“±</span>;

const Stopwatch = ({ dayData, setDayData, expectedMins, isSticky, setIsSticky }) => {
  const [displayTime, setDisplayTime] = useState(0);
  const intervalRef = useRef(null);
  const isRunning = dayData.stopwatchRunning || false;
  const accumulatedTime = dayData.stopwatchTime || 0;
  const startedAt = dayData.stopwatchStartedAt;
  
  useEffect(() => {
    if (isRunning && startedAt) {
      intervalRef.current = setInterval(() => { setDisplayTime(accumulatedTime + Math.floor((Date.now() - startedAt) / 1000)); }, 1000);
    } else { setDisplayTime(accumulatedTime); }
    return () => clearInterval(intervalRef.current);
  }, [isRunning, startedAt, accumulatedTime]);
  
  const start = () => setDayData({ ...dayData, stopwatchRunning: true, stopwatchStartedAt: Date.now() });
  const pause = () => { const elapsed = startedAt ? Math.floor((Date.now() - startedAt) / 1000) : 0; setDayData({ ...dayData, stopwatchRunning: false, stopwatchTime: accumulatedTime + elapsed, stopwatchStartedAt: null }); };
  const reset = () => setDayData({ ...dayData, stopwatchRunning: false, stopwatchTime: 0, stopwatchStartedAt: null });
  const formatTime = (s) => { const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sec = s % 60; return h > 0 ? `${h}:${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}` : `${m}:${sec.toString().padStart(2, '0')}`; };
  const actualMins = Math.floor(displayTime / 60), diff = actualMins - expectedMins;
  const diffText = diff === 0 ? 'on target' : diff > 0 ? `+${diff}m` : `${diff}m`;
  const diffColor = diff <= 0 ? 'text-green-400' : diff <= 10 ? 'text-yellow-400' : 'text-red-400';
  
  return (
    <div className={`mb-3 bg-gray-800 text-white rounded-lg p-3 ${isSticky ? 'sticky top-0 z-20 shadow-lg' : ''}`}>
      <div className="flex items-center justify-between">
        <div><div className="text-3xl font-mono font-bold">{formatTime(displayTime)}</div><div className="text-xs text-gray-400">Expected: ~{expectedMins}m â€¢ <span className={diffColor}>{diffText}</span></div></div>
        <div className="flex gap-2 items-center">
          <button onClick={() => setIsSticky(!isSticky)} className={`px-2 py-1 rounded text-xs ${isSticky ? 'bg-blue-600' : 'bg-gray-600'}`} title="Pin stopwatch">{isSticky ? 'ğŸ“Œ' : 'ğŸ“'}</button>
          {!isRunning ? <button onClick={start} className="px-4 py-2 bg-green-600 rounded-lg font-bold text-xl">â–¶</button> : <button onClick={pause} className="px-4 py-2 bg-yellow-600 rounded-lg font-bold text-xl">â¸</button>}
          <button onClick={reset} className="px-3 py-2 bg-gray-600 rounded-lg text-sm">â†º</button>
        </div>
      </div>
    </div>
  );
};

const BugsSection = ({ cycleDay, bugs, setBugs }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [newBug, setNewBug] = useState('');
  const cycleBugs = bugs[cycleDay] || [];
  const openBugs = cycleBugs.filter(b => !b.fixed);
  const fixedBugs = cycleBugs.filter(b => b.fixed);
  const addBug = () => { if (!newBug.trim()) return; setBugs({ ...bugs, [cycleDay]: [...cycleBugs, { id: Date.now(), text: newBug.trim(), fixed: false }] }); setNewBug(''); };
  const toggleBug = (id) => setBugs({ ...bugs, [cycleDay]: cycleBugs.map(b => b.id === id ? { ...b, fixed: !b.fixed } : b) });
  const deleteBug = (id) => setBugs({ ...bugs, [cycleDay]: cycleBugs.filter(b => b.id !== id) });
  
  return (
    <div className="mb-3 border-2 border-red-200 rounded-lg overflow-hidden">
      <button onClick={() => setIsOpen(!isOpen)} className="w-full bg-red-100 p-2 font-bold text-red-800 text-sm flex justify-between items-center">
        <span>ğŸ› Bugs Day {cycleDay} ({openBugs.length} open)</span><span>{isOpen ? 'â–¼' : 'â–¶'}</span>
      </button>
      {isOpen && (
        <div className="p-2 bg-white">
          <div className="flex gap-2 mb-2"><input type="text" value={newBug} onChange={(e) => setNewBug(e.target.value)} placeholder="Describe bug..." className="flex-1 px-2 py-1 text-sm border rounded" onKeyPress={(e) => e.key === 'Enter' && addBug()} /><button onClick={addBug} className="px-3 py-1 bg-red-500 text-white rounded text-sm">Add</button></div>
          {openBugs.length > 0 && <div className="mb-2"><div className="text-xs text-gray-500 mb-1">Open:</div>{openBugs.map(bug => (<div key={bug.id} className="flex items-center gap-2 p-2 bg-red-50 rounded mb-1"><input type="checkbox" checked={false} onChange={() => toggleBug(bug.id)} className="w-4 h-4" /><span className="flex-1 text-sm">{bug.text}</span></div>))}</div>}
          {fixedBugs.length > 0 && <div><div className="text-xs text-gray-500 mb-1">Fixed:</div>{fixedBugs.map(bug => (<div key={bug.id} className="flex items-center gap-2 p-2 bg-green-50 rounded mb-1"><input type="checkbox" checked={true} onChange={() => toggleBug(bug.id)} className="w-4 h-4" /><span className="flex-1 text-sm line-through text-gray-400">{bug.text}</span><button onClick={() => deleteBug(bug.id)} className="text-red-400 text-xs">âœ•</button></div>))}</div>}
          {cycleBugs.length === 0 && <div className="text-xs text-gray-400 text-center py-2">No bugs logged.</div>}
        </div>
      )}
    </div>
  );
};

const UpdatesSection = ({ cycleDay, updates, setUpdates }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [newUpdate, setNewUpdate] = useState('');
  const cycleUpdates = updates[cycleDay] || [];
  const openUpdates = cycleUpdates.filter(u => !u.done);
  const doneUpdates = cycleUpdates.filter(u => u.done);
  const addUpdate = () => { if (!newUpdate.trim()) return; setUpdates({ ...updates, [cycleDay]: [...cycleUpdates, { id: Date.now(), text: newUpdate.trim(), done: false }] }); setNewUpdate(''); };
  const toggleUpdate = (id) => setUpdates({ ...updates, [cycleDay]: cycleUpdates.map(u => u.id === id ? { ...u, done: !u.done } : u) });
  const deleteUpdate = (id) => setUpdates({ ...updates, [cycleDay]: cycleUpdates.filter(u => u.id !== id) });
  
  return (
    <div className="mb-3 border-2 border-purple-200 rounded-lg overflow-hidden">
      <button onClick={() => setIsOpen(!isOpen)} className="w-full bg-purple-100 p-2 font-bold text-purple-800 text-sm flex justify-between items-center">
        <span>ğŸ“ Updates Day {cycleDay} ({openUpdates.length} pending)</span><span>{isOpen ? 'â–¼' : 'â–¶'}</span>
      </button>
      {isOpen && (
        <div className="p-2 bg-white">
          <div className="flex gap-2 mb-2"><input type="text" value={newUpdate} onChange={(e) => setNewUpdate(e.target.value)} placeholder="Describe update..." className="flex-1 px-2 py-1 text-sm border rounded" onKeyPress={(e) => e.key === 'Enter' && addUpdate()} /><button onClick={addUpdate} className="px-3 py-1 bg-purple-500 text-white rounded text-sm">Add</button></div>
          {openUpdates.length > 0 && <div className="mb-2"><div className="text-xs text-gray-500 mb-1">Pending:</div>{openUpdates.map(update => (<div key={update.id} className="flex items-center gap-2 p-2 bg-purple-50 rounded mb-1"><input type="checkbox" checked={false} onChange={() => toggleUpdate(update.id)} className="w-4 h-4" /><span className="flex-1 text-sm">{update.text}</span></div>))}</div>}
          {doneUpdates.length > 0 && <div><div className="text-xs text-gray-500 mb-1">Done:</div>{doneUpdates.map(update => (<div key={update.id} className="flex items-center gap-2 p-2 bg-green-50 rounded mb-1"><input type="checkbox" checked={true} onChange={() => toggleUpdate(update.id)} className="w-4 h-4" /><span className="flex-1 text-sm line-through text-gray-400">{update.text}</span><button onClick={() => deleteUpdate(update.id)} className="text-red-400 text-xs">âœ•</button></div>))}</div>}
          {cycleUpdates.length === 0 && <div className="text-xs text-gray-400 text-center py-2">No updates logged.</div>}
        </div>
      )}
    </div>
  );
};

const Section = ({ section, sectionIndex, dayData, setDayData, cycleDay, cardioMachine, showGlutes, showTGU, phase, weekType }) => {
  const [isOpen, setIsOpen] = useState(true);
  if (section.isConditionalGlutes && !showGlutes) return null;
  let exercises = section.isCalisthenics ? (calisthenicsRotation[cycleDay]?.exercises || []) : section.exercises;
  exercises = exercises.filter(ex => !ex.isConditionalTGU || showTGU);
  if (!section.protected && !section.isCalisthenics) exercises = exercises.map(ex => modifyExerciseForPhase(ex, phase));
  // Reduce calisthenics to 2 sets in Phase 1
  if (section.isCalisthenics && phase === 1) exercises = exercises.map(ex => ({ ...ex, reps: ex.reps.replace(/3 Ã—/g, '2 Ã—') }));
  // Handle isometrics A/B based on week type
  exercises = exercises.map(ex => {
    if (ex.name.includes(' / B: ')) {
      const [nameA, nameB] = ex.name.split(' / B: ');
      const [repsA, repsB] = ex.reps.split(' / ');
      const cleanNameA = nameA.replace('A: ', '');
      const cleanNameB = nameB;
      return weekType === 'A' 
        ? { ...ex, name: cleanNameA, reps: repsA }
        : { ...ex, name: cleanNameB, reps: repsB };
    }
    return ex;
  });
  // Apply phase modification to isometrics AFTER A/B split
  exercises = exercises.map(ex => modifyExerciseForPhase(ex, phase));
  if (exercises.length === 0 && !section.isCalisthenics) return null;
  const checks = dayData.checks || {}, weights = dayData.weights || {};
  const allChecked = exercises.length > 0 && exercises.every((_, i) => checks[`${sectionIndex}-${i}`]);
  const toggleCheck = (i) => setDayData({ ...dayData, checks: { ...checks, [`${sectionIndex}-${i}`]: !checks[`${sectionIndex}-${i}`] } });
  const updateWeight = (i, v) => setDayData({ ...dayData, weights: { ...weights, [`${sectionIndex}-${i}`]: v } });
  const sectionTitle = section.isCalisthenics ? `ğŸƒ Cal Day ${cycleDay}: ${calisthenicsRotation[cycleDay]?.focus}` : section.name.replace('(A/B)', `(${weekType})`);
  const isProtected = section.protected || section.isCalisthenics;

  return (
    <div className="mb-2 border border-gray-200 rounded-lg overflow-hidden">
      <button onClick={() => setIsOpen(!isOpen)} className={`w-full p-2 flex items-center justify-between text-left text-sm font-medium ${allChecked ? 'bg-green-100 text-green-800' : isProtected ? 'bg-blue-50 border-l-4 border-blue-400' : 'bg-gray-50'}`}>
        <div className="flex items-center gap-2"><span>{isOpen ? 'â–¼' : 'â–¶'}</span><span>{sectionTitle}</span>{section.isCalisthenics && <span className="text-green-600 text-xs">ğŸ“±</span>}{isProtected && !section.isCalisthenics && <span className="text-blue-600 text-xs">âœ“ full</span>}</div>
        {allChecked && <span className="text-green-600">âœ“</span>}
      </button>
      {isOpen && (<div className="p-2 bg-white">{exercises.map((ex, i) => {
        const isChecked = checks[`${sectionIndex}-${i}`] || false, weight = weights[`${sectionIndex}-${i}`] || '';
        return (<div key={i} className={`flex items-center gap-2 p-2 rounded ${isChecked ? 'bg-green-50' : ''}`}>
          <input type="checkbox" checked={isChecked} onChange={() => toggleCheck(i)} className="w-5 h-5 rounded flex-shrink-0" />
          <div className="flex-1 min-w-0"><div className={`text-sm flex items-center ${isChecked ? 'line-through text-gray-400' : ''}`}>{ex.name === "Machine cardio (rotate)" ? cardioMachine : ex.name}{videoLinks[ex.name] && <VideoLink name={ex.name} />}{ex.inApp && <AppBadge />}</div><div className={`text-xs ${isChecked ? 'text-gray-300' : 'text-gray-500'}`}>{ex.reps}</div></div>
          {(ex.trackWeight || ex.trackTime) && <input type="text" placeholder={ex.trackWeight ? "kg" : "sec"} value={weight} onChange={(e) => updateWeight(i, e.target.value)} className="w-14 px-2 py-1 text-xs border rounded text-center" />}
        </div>);
      })}</div>)}
    </div>
  );
};

function TrainingApp() {
  const [selectedDate, setSelectedDate] = useState(() => { const t = new Date(); return t < PROGRAM_START ? formatDate(PROGRAM_START) : formatDate(t); });
  const [allData, setAllData] = useState({});
  const [bugs, setBugs] = useState({});
  const [updates, setUpdates] = useState({});
  const [isSticky, setIsSticky] = useState(false);
  const [view, setView] = useState('today');
  const [loading, setLoading] = useState(true);

  const currentDate = parseDate(selectedDate);
  const session = getSession(currentDate), sessionData = trainingData[session];
  const cycleDay = getCycleDay(currentDate), weekNum = getWeekNumber(currentDate), weekType = getWeekType(currentDate);
  const custody = getCustody(currentDate), cardioMachine = getCardioMachine(currentDate);
  const showGlutes = getShowGlutes(currentDate), showTGU = getShowTGU(currentDate), phase = getAcclimatisationPhase(currentDate);
  const dayData = allData[selectedDate] || { checks: {}, weights: {} };

  const getSessionTime = () => phase === 1 && sessionData.timePhase1 ? sessionData.timePhase1 : phase === 2 && sessionData.timePhase2 ? sessionData.timePhase2 : sessionData.time;
  const getExpectedMins = () => {
    const timeStr = getSessionTime();
    const match = timeStr.match(/(\d+)/);
    return match ? parseInt(match[1]) : 60;
  };

  useEffect(() => { try { const s = localStorage.getItem(STORAGE_KEY); if (s) setAllData(JSON.parse(s)); const b = localStorage.getItem(BUGS_KEY); if (b) setBugs(JSON.parse(b)); const u = localStorage.getItem(UPDATES_KEY); if (u) setUpdates(JSON.parse(u)); } catch (e) {} setLoading(false); }, []);
  useEffect(() => { if (!loading) { try { localStorage.setItem(STORAGE_KEY, JSON.stringify(allData)); localStorage.setItem(BUGS_KEY, JSON.stringify(bugs)); localStorage.setItem(UPDATES_KEY, JSON.stringify(updates)); } catch (e) {} } }, [allData, bugs, updates, loading]);

  const setDayData = (d) => setAllData({ ...allData, [selectedDate]: d });
  const navigateDay = (delta) => { const d = new Date(currentDate); d.setDate(d.getDate() + delta); if (d >= PROGRAM_START && d <= PROGRAM_END) setSelectedDate(formatDate(d)); };
  const resetDay = () => setDayData({ checks: {}, weights: {} });

  const getProgress = () => {
    const checks = dayData.checks || {};
    let totalMins = 0, doneMins = 0;
    getDailyNonNegotiables(phase).forEach((item, i) => { totalMins += item.mins; if (checks[`daily-${i}`]) doneMins += item.mins; });
    sessionData.sections.forEach((sec, si) => {
      if (sec.isConditionalGlutes && !showGlutes) return;
      let exs = sec.isCalisthenics ? (calisthenicsRotation[cycleDay]?.exercises || []) : sec.exercises;
      exs = exs.filter(ex => !ex.isConditionalTGU || showTGU);
      if (!sec.protected && !sec.isCalisthenics) exs = exs.map(ex => modifyExerciseForPhase(ex, phase));
      exs.forEach((ex, ei) => { const mins = ex.mins || 2; totalMins += mins; if (checks[`${si}-${ei}`]) doneMins += mins; });
    });
    return totalMins > 0 ? Math.round((doneMins / totalMins) * 100) : 0;
  };

  const formatDisplayDate = (d) => d.toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric', month: 'short' });
  const totalBugsOpen = Object.values(bugs).flat().filter(b => !b.fixed).length;

  if (loading) return <div className="p-4 text-center">Loading...</div>;

  return (
    <div className="min-h-screen bg-gray-100 pb-20">
      <div className="bg-blue-600 text-white p-3 sticky top-0 z-10 safe-top">
        <div className="flex justify-between items-center">
          <div><div className="text-lg font-bold">Week {weekNum} of 26</div><div className="text-xs opacity-80">Week {weekType} â€¢ Day {cycleDay}/14 {totalBugsOpen > 0 && `â€¢ ğŸ›${totalBugsOpen}`}</div></div>
          <div className="text-right"><div className="text-2xl font-bold">{getProgress()}%</div><div className="text-xs opacity-80">today</div></div>
        </div>
        {phase > 0 && <div className={`mt-2 p-2 rounded-lg text-xs font-medium ${phase === 1 ? 'bg-green-500/30' : 'bg-yellow-500/30'}`}><span>âš¡ {getPhaseLabel(phase)} â€¢ {phase === 1 ? 'Weeks 1-2' : 'Weeks 3-4'}</span></div>}
        <div className="flex items-center justify-between mt-3 bg-blue-500 rounded-lg p-2">
          <button onClick={() => navigateDay(-1)} className="p-1 text-xl">â—€</button>
          <div className="text-center"><div className="font-bold">{formatDisplayDate(currentDate)}</div><div className="text-xs opacity-80">{custody}</div></div>
          <button onClick={() => navigateDay(1)} className="p-1 text-xl">â–¶</button>
        </div>
      </div>

      <div className="bg-white border-b flex text-xs">
        {[{ id: 'today', icon: 'ğŸ“‹', label: 'Today' }, { id: 'calendar', icon: 'ğŸ“…', label: 'Calendar' }, { id: 'progress', icon: 'ğŸ“ˆ', label: 'Progress' }, { id: 'info', icon: 'â„¹ï¸', label: 'Info' }].map(tab => (
          <button key={tab.id} onClick={() => setView(tab.id)} className={`flex-1 p-2 text-center font-medium ${view === tab.id ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'}`}>{tab.icon} {tab.label}</button>
        ))}
      </div>

      {view === 'today' ? (
        <div className="p-3">
          <div className="flex justify-between items-center mb-3">
            <div><h2 className="font-bold">{sessionData.title}</h2><p className="text-xs text-gray-500">{getSessionTime()}</p><p className="text-xs text-purple-600">Cal Day {cycleDay}: {calisthenicsRotation[cycleDay]?.focus}</p></div>
            <button onClick={resetDay} className="p-2 text-gray-400">ğŸ”„</button>
          </div>
          <Stopwatch dayData={dayData} setDayData={setDayData} expectedMins={getExpectedMins()} isSticky={isSticky} setIsSticky={setIsSticky} />
          <BugsSection cycleDay={cycleDay} bugs={bugs} setBugs={setBugs} />
          <UpdatesSection cycleDay={cycleDay} updates={updates} setUpdates={setUpdates} />
          <div className="mb-3 p-2 bg-gray-50 rounded text-xs flex flex-wrap gap-3"><span>ğŸ“¹ = YouTube</span><span>ğŸ“± = In app</span><span className="text-blue-600">âœ“ full = Protected</span></div>
          <div className="mb-3 border-2 border-blue-200 rounded-lg overflow-hidden">
            <div className="bg-blue-100 p-2 font-bold text-blue-800 text-sm">ğŸ“Œ Daily Non-Negotiables</div>
            <div className="p-2 bg-white">{getDailyNonNegotiables(phase).map((item, i) => {
              const key = `daily-${i}`, isChecked = (dayData.checks || {})[key];
              return (<label key={i} className={`flex items-center gap-2 p-2 rounded ${isChecked ? 'bg-green-50' : ''}`}><input type="checkbox" checked={isChecked || false} onChange={() => setDayData({ ...dayData, checks: { ...(dayData.checks || {}), [key]: !isChecked } })} className="w-5 h-5 rounded" /><span className={`text-sm ${isChecked ? 'line-through text-gray-400' : ''}`}>{item.name}</span><span className="text-xs text-gray-400 ml-auto">{item.mins}m</span></label>);
            })}</div>
          </div>
          {sessionData.sections.map((sec, i) => <Section key={i} section={sec} sectionIndex={i} dayData={dayData} setDayData={setDayData} cycleDay={cycleDay} cardioMachine={cardioMachine} showGlutes={showGlutes} showTGU={showTGU} phase={phase} weekType={weekType} />)}
        </div>
      ) : view === 'calendar' ? (
        <div className="p-3">
          <h2 className="font-bold mb-3">Jump to Date</h2>
          <div className="grid grid-cols-7 gap-1 text-xs">
            {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((d, i) => <div key={i} className="text-center font-bold text-gray-500 p-1">{d}</div>)}
            {(() => {
              const days = [], current = new Date(PROGRAM_START);
              for (let i = 0; i < current.getDay(); i++) days.push(<div key={`e-${i}`} className="p-1" />);
              while (current <= PROGRAM_END) {
                const ds = formatDate(current), hasData = allData[ds] && Object.keys(allData[ds].checks || {}).length > 0;
                const isSel = ds === selectedDate, dp = getAcclimatisationPhase(current), dc = getCycleDay(current);
                const hasBugs = (bugs[dc] || []).filter(b => !b.fixed).length > 0;
                days.push(<button key={ds} onClick={() => { setSelectedDate(ds); setView('today'); }} className={`p-1 text-center rounded relative ${isSel ? 'bg-blue-600 text-white' : hasData ? 'bg-green-100 text-green-800' : dp === 1 ? 'bg-green-50' : dp === 2 ? 'bg-yellow-50' : 'bg-white'}`}>{current.getDate()}{hasBugs && <span className="absolute top-0 right-0 w-2 h-2 bg-orange-500 rounded-full"></span>}</button>);
                current.setDate(current.getDate() + 1);
              }
              return days;
            })()}
          </div>
          <div className="mt-4 flex flex-wrap gap-3 text-xs"><div className="flex items-center gap-1"><div className="w-3 h-3 bg-green-100 rounded" /> Logged</div><div className="flex items-center gap-1"><div className="w-3 h-3 bg-blue-600 rounded" /> Selected</div><div className="flex items-center gap-1"><div className="w-3 h-3 bg-green-50 rounded border" /> Phase 1</div><div className="flex items-center gap-1"><div className="w-3 h-3 bg-yellow-50 rounded border" /> Phase 2</div><div className="flex items-center gap-1"><div className="w-2 h-2 bg-orange-500 rounded-full" /> Has bugs</div></div>
        </div>
      ) : view === 'progress' ? (
        <div className="p-3">
          <h2 className="font-bold mb-3">ğŸ“ˆ Weight Progress</h2>
          {['Leg Press', 'Converging Chest Press', 'Lat Pulldown', 'Barbell Romanian Deadlift', 'Chest-Supported Row', 'Incline Dumbbell Press', 'Barbell Hip Thrust', 'Bulgarian Split Squat', 'KB swings', 'Turkish get-up (left)'].map(exercise => {
            const history = [];
            Object.entries(allData).forEach(([date, data]) => { if (data.weights) { Object.entries(data.weights).forEach(([key, value]) => { if (value) { const st = getSession(parseDate(date)), si = trainingData[st]; si.sections.forEach((sec, s) => { sec.exercises.forEach((ex, e) => { if (`${s}-${e}` === key && ex.name === exercise) history.push({ date, weight: value }); }); }); } }); } });
            if (history.length === 0) return null;
            return (<div key={exercise} className="bg-white p-3 rounded-lg border mb-2"><h3 className="font-medium text-sm">{exercise}</h3><div className="flex flex-wrap gap-2 mt-2">{history.sort((a, b) => a.date.localeCompare(b.date)).slice(-8).map((h, i) => (<div key={i} className="text-xs bg-gray-100 px-2 py-1 rounded"><div className="font-bold">{h.weight}kg</div><div className="text-gray-500">{h.date.slice(5)}</div></div>))}</div></div>);
          })}
          {Object.keys(allData).length === 0 && <div className="text-center text-gray-400 py-8">No data yet. Start logging!</div>}
        </div>
      ) : (
        <div className="p-3 space-y-3">
          <div className="bg-gradient-to-r from-green-50 to-yellow-50 rounded-lg p-3 border border-green-200"><h3 className="font-bold text-sm mb-2">ğŸŒ± 4-Week Acclimatisation</h3><div className="text-xs space-y-1"><div><span className="font-bold text-green-600">Weeks 1-2:</span> 1Ã—5 reps, TGU bodyweight Ã—5, glutes Sunday only</div><div><span className="font-bold text-yellow-600">Weeks 3-4:</span> 1Ã—6-8 reps, TGU light Ã—3, glutes 2Ã—/week</div><div><span className="font-bold text-blue-600">Week 5+:</span> Full program</div></div><div className="mt-2 pt-2 border-t border-green-200 text-xs"><span className="font-medium">Protected:</span> Core & Calisthenics</div></div>
          <div className="bg-white rounded-lg p-3 border"><h3 className="font-bold text-sm mb-2">ğŸ“… Program: Jan 26 - Jul 21, 2026</h3><p className="text-xs text-gray-600">26 weeks â€¢ Target: 85kg</p></div>
          <div className="bg-white rounded-lg p-3 border"><h3 className="font-bold text-sm mb-2">â±ï¸ Stopwatch</h3><p className="text-xs text-gray-600">Track actual time. Start/pause for split sessions. Compares to expected.</p></div>
          <div className="bg-white rounded-lg p-3 border"><h3 className="font-bold text-sm mb-2">ğŸ› Bug Tracking</h3><p className="text-xs text-gray-600">Bugs linked to cycle day (1-14). Same bugs appear 2 weeks later. Mark fixed, then delete.</p></div>
          <div className="bg-white rounded-lg p-3 border"><h3 className="font-bold text-sm mb-2">ğŸ¯ 2RIR Rule</h3><p className="text-xs text-gray-600">Stop when you could do 2 more reps.</p></div>
          <div className="bg-yellow-50 rounded-lg p-3 border border-yellow-200"><h3 className="font-bold text-sm mb-2 text-yellow-800">Remember</h3><ul className="text-xs text-yellow-700 space-y-1"><li>âœ“ Good enough for now</li><li>âœ“ Stay the course</li><li>âœ“ Imperfection is not the enemy, distraction is</li></ul></div>
          <div className="text-center text-xs text-gray-400 mt-4">v18 â€¢ Jan 26, 2026</div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<TrainingApp />);
  </script>
  <script>if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js').then(() => console.log('SW registered')); }</script>
</body>
</html>
