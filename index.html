<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2563eb">
  <title>Training App</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    * { -webkit-tap-highlight-color: transparent; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect, useRef } = React;

const STORAGE_KEY = 'training-log-v5';
const BUGS_KEY = 'training-bugs-v1';
const PROGRAM_START = new Date('2026-01-19');
const PROGRAM_END = new Date('2026-07-12');

const videoLinks = {
  "Shoulder dislocates": "https://www.youtube.com/results?search_query=shoulder+dislocates+pass+through+stick+tutorial",
  "Broomstick good morning": "https://www.youtube.com/results?search_query=broomstick+good+morning+stretch+tutorial",
  "Broomstick squat": "https://www.youtube.com/results?search_query=overhead+squat+mobility+broomstick+tutorial",
  "Scapula dips": "https://www.youtube.com/watch?v=1AOk_LhHjsA",
  "Scapula press-ups": "https://www.youtube.com/watch?v=y4Wo095zPnc",
  "Scapula pull-downs": "https://www.youtube.com/watch?v=eSgqmaVsKT4",
  "Scapula pull-ups": "https://www.youtube.com/watch?v=VoqhOCR6dkQ",
  "Leg Press": "https://www.youtube.com/watch?v=IZxyjW7MPJQ",
  "Converging Chest Press": "https://www.youtube.com/watch?v=xUm0BiZCWlQ",
  "Lat Pulldown": "https://www.youtube.com/watch?v=CAwf7n6Luuc",
  "Barbell Romanian Deadlift": "https://www.youtube.com/watch?v=7AaaYhMqTws",
  "Cable Lateral Raise": "https://www.youtube.com/watch?v=PPrzBWZDOhA",
  "Incline Dumbbell Curl": "https://www.youtube.com/watch?v=soxrZlIl35U",
  "Reverse Pec Deck": "https://www.youtube.com/watch?v=5YK4bgzXDp0",
  "Chest-Supported Row": "https://www.youtube.com/watch?v=H75im9fAUMc",
  "Incline Dumbbell Press": "https://www.youtube.com/watch?v=8iPEnn-ltC8",
  "Barbell Hip Thrust": "https://www.youtube.com/watch?v=LM8XHLYJoYs",
  "Bulgarian Split Squat": "https://www.youtube.com/watch?v=2C-uNgKwPLE",
  "Barbell Skull Crusher": "https://www.youtube.com/watch?v=d_KZxkY_0cM",
  "High Incline Shrugs": "https://www.youtube.com/watch?v=dj3r9xisP_E",
  "Cable Crunches": "https://www.youtube.com/watch?v=AV5PmZJIrrw",
  "Cable crunches": "https://www.youtube.com/watch?v=AV5PmZJIrrw",
  "Cable Woodchops": "https://www.youtube.com/watch?v=pAplQXk3dkU",
  "Cable woodchops": "https://www.youtube.com/watch?v=pAplQXk3dkU",
  "Leg raises": "https://www.youtube.com/watch?v=JB2oyawG9KI",
  "Side plank (left)": "https://www.youtube.com/watch?v=K2VljzCC16g",
  "Side plank (right)": "https://www.youtube.com/watch?v=K2VljzCC16g",
  "Russian twists": "https://www.youtube.com/watch?v=wkD8rjkodUI",
  "Russian twists (KB)": "https://www.youtube.com/watch?v=wkD8rjkodUI",
  "Clamshells": "https://www.youtube.com/watch?v=cD8TC_boFPo",
  "Fire hydrants": "https://www.youtube.com/watch?v=La3xYT8MGks",
  "Glute bridges": "https://www.youtube.com/watch?v=OUgsJ8-Vi0E",
  "Banded walks": "https://www.youtube.com/watch?v=jgh6sGwtTwk",
  "Donkey kicks": "https://www.youtube.com/watch?v=vM6yWsPFels",
  "A: Clamshells / B: Banded walks": "https://www.youtube.com/watch?v=cD8TC_boFPo",
  "A: Fire hydrants / B: SL glute bridge": "https://www.youtube.com/watch?v=La3xYT8MGks",
  "A: Glute bridges / B: Donkey kicks": "https://www.youtube.com/watch?v=OUgsJ8-Vi0E",
  "Isometric ball extension (left)": "https://www.youtube.com/results?search_query=glute+med+isometric+ball+wall+exercise",
  "Isometric ball extension (right)": "https://www.youtube.com/results?search_query=glute+med+isometric+ball+wall+exercise",
  "Swiss ball leg curl (both)": "https://www.youtube.com/results?search_query=swiss+ball+hamstring+curl+tutorial",
  "Swiss ball leg curl (left)": "https://www.youtube.com/results?search_query=single+leg+swiss+ball+hamstring+curl",
  "Swiss ball leg curl (right)": "https://www.youtube.com/results?search_query=single+leg+swiss+ball+hamstring+curl",
  "DB single leg RDL (left)": "https://www.youtube.com/results?search_query=single+leg+dumbbell+rdl+same+side+tutorial",
  "DB single leg RDL (right)": "https://www.youtube.com/results?search_query=single+leg+dumbbell+rdl+same+side+tutorial",
  "Single leg hip thrust (left)": "https://www.youtube.com/results?search_query=single+leg+hip+thrust+tutorial",
  "Single leg hip thrust (right)": "https://www.youtube.com/results?search_query=single+leg+hip+thrust+tutorial",
  "Inchworms": "https://www.youtube.com/results?search_query=inchworm+exercise+tutorial",
  "Figure 4 stretch (left)": "https://www.youtube.com/results?search_query=figure+4+piriformis+stretch",
  "Figure 4 stretch (right)": "https://www.youtube.com/results?search_query=figure+4+piriformis+stretch",
  "Sidestep miniband": "https://www.youtube.com/results?search_query=miniband+sidestep+glute+med",
  "Side-lying quad stretch (left)": "https://www.youtube.com/results?search_query=side+lying+quad+stretch",
  "Side-lying quad stretch (right)": "https://www.youtube.com/results?search_query=side+lying+quad+stretch",
  "Parallette dips": "https://www.youtube.com/results?search_query=parallette+dips+tutorial",
  "Wall sit": "https://www.youtube.com/watch?v=y-wV4Lz-g-4",
  "A: Wall sit / B: Handgrip": "https://www.youtube.com/watch?v=y-wV4Lz-g-4",
  "A: SL wall sit / B: Plank": "https://www.youtube.com/watch?v=y-wV4Lz-g-4",
  "KB swings": "https://www.youtube.com/watch?v=YSxHifyI6s8",
  "Turkish get-up (left)": "https://www.youtube.com/watch?v=0bWRPC49-KI",
  "Turkish get-up (right)": "https://www.youtube.com/watch?v=0bWRPC49-KI",
  "Active hang": "https://www.youtube.com/watch?v=HoE-C85ZlCE",
  "Passive hang": "https://www.youtube.com/watch?v=HoE-C85ZlCE",
  "Hip abductor machine": "https://www.youtube.com/watch?v=FoEGVh49bck",
  "Hip adductor machine": "https://www.youtube.com/watch?v=oMfZhG-wRjk",
  "Cable pull-throughs": "https://www.youtube.com/watch?v=ArPyMgdGaQY",
  "Hip flexor stretch (left)": "https://www.youtube.com/watch?v=YQmpO9VT2X4",
  "Hip flexor stretch (right)": "https://www.youtube.com/watch?v=YQmpO9VT2X4",
};

const formatDate = (date) => date.toISOString().split('T')[0];
const parseDate = (str) => new Date(str + 'T00:00:00');
const getDayOfWeek = (date) => ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][date.getDay()];
const getWeekNumber = (date) => Math.floor((date - PROGRAM_START) / (1000 * 60 * 60 * 24 * 7)) + 1;
const getWeekType = (date) => getWeekNumber(date) % 2 === 1 ? 'A' : 'B';
const getCycleDay = (date) => (Math.floor((date - PROGRAM_START) / (1000 * 60 * 60 * 24)) % 14) + 1;

const getSession = (date) => {
  const day = getDayOfWeek(date);
  const week = getWeekType(date);
  const scheduleA = { 'Sat': 'gymRecoveryWeekend', 'Sun': 'rest', 'Mon': 'gymDay1', 'Tue': 'gymDay2', 'Wed': 'homeFull', 'Thu': 'gymRecoveryWeekday', 'Fri': 'homeFull' };
  const scheduleB = { 'Sat': 'gymRecoveryWeekend', 'Sun': 'rest', 'Mon': 'homeFull', 'Tue': 'gymDay1', 'Wed': 'homeLight', 'Thu': 'gymDay2', 'Fri': 'homeFull' };
  return week === 'A' ? scheduleA[day] : scheduleB[day];
};

const getCustody = (date) => {
  const day = getDayOfWeek(date);
  const week = getWeekType(date);
  const custodyA = { 'Sat': 'mum', 'Sun': 'mum', 'Mon': 'mum', 'Tue': 'mum', 'Wed': 'me', 'Thu': 'mum', 'Fri': 'me' };
  const custodyB = { 'Sat': 'me', 'Sun': 'me', 'Mon': 'me', 'Tue': 'mum', 'Wed': 'me', 'Thu': 'mum', 'Fri': 'me' };
  return (week === 'A' ? custodyA[day] : custodyB[day]) === 'me' ? 'Boys with me' : "Boys at mum's";
};

const getCardioMachine = (date) => {
  const day = getDayOfWeek(date);
  const week = getWeekType(date);
  const machinesA = { 'Sat': 'Rowing', 'Mon': 'Elliptical', 'Tue': 'Ski-erg', 'Thu': 'Cycling' };
  const machinesB = { 'Sat': 'Ski-erg', 'Tue': 'Rowing', 'Thu': 'Elliptical' };
  return week === 'A' ? machinesA[day] : machinesB[day];
};

const getShowGlutes = (date) => getSession(date) === 'rest' || getDayOfWeek(date) === 'Wed';
const getShowTGU = (date) => {
  const day = getDayOfWeek(date);
  const week = getWeekType(date);
  const session = getSession(date);
  if (session === 'gymRecoveryWeekend') return true;
  if (session === 'homeFull' && day === 'Wed' && week === 'A') return true;
  if (session === 'homeFull' && day === 'Fri' && week === 'B') return true;
  return false;
};

const calisthenicsRotation = {
  1: { focus: "Chest", exercises: [{ name: "Knee push up", reps: "3 √ó 6-12", inApp: true, mins: 3 }, { name: "Bench dip", reps: "3 √ó 6-12", inApp: true, mins: 3 }]},
  2: { focus: "Back", exercises: [{ name: "Superman pulses", reps: "3 √ó 10-20", inApp: true, mins: 3 }, { name: "Towel row", reps: "3 √ó 8-15", inApp: true, mins: 3 }]},
  3: { focus: "Legs", exercises: [{ name: "Bench squat", reps: "3 √ó 8-15", inApp: true, mins: 3 }, { name: "Alternating lunge", reps: "3 √ó 10-20", inApp: true, mins: 3 }]},
  4: { focus: "Shoulders", exercises: [{ name: "Incline pike push up", reps: "3 √ó 6-12", inApp: true, mins: 3 }, { name: "Pike shoulder taps", reps: "3 √ó 10-20", inApp: true, mins: 3 }]},
  5: { focus: "Arms", exercises: [{ name: "Knee tricep extensions", reps: "3 √ó 6-12", inApp: true, mins: 3 }, { name: "Banded bicep curls", reps: "3 √ó 6-12", inApp: true, mins: 3 }]},
  6: { focus: "Abs/Core", exercises: [{ name: "Elbow plank", reps: "3 √ó 20-40 sec", inApp: true, mins: 3 }, { name: "Alternating single leg kickouts", reps: "3 √ó 10-20", inApp: true, mins: 3 }]},
  7: { focus: "Mobility", exercises: [{ name: "Cat to cow", reps: "3 √ó 6-12", inApp: true, mins: 3 }, { name: "Downward facing dog", reps: "3 √ó 15-30 sec", inApp: true, mins: 3 }]},
  8: { focus: "Chest", exercises: [{ name: "Push up", reps: "3 √ó 6-12", inApp: true, mins: 3 }, { name: "Elevated bench dips", reps: "3 √ó 6-12", inApp: true, mins: 3 }]},
  9: { focus: "Back", exercises: [{ name: "Table rows", reps: "3 √ó 6-12", inApp: true, mins: 3 }, { name: "Y-wall stretch", reps: "3 √ó 10-20", inApp: true, mins: 3 }]},
  10: { focus: "Legs", exercises: [{ name: "Squat", reps: "3 √ó 8-15", inApp: true, mins: 3 }, { name: "Alternating side lunge", reps: "3 √ó 10-20", inApp: true, mins: 3 }]},
  11: { focus: "Shoulders", exercises: [{ name: "Pike push up", reps: "3 √ó 5-10", inApp: true, mins: 3 }, { name: "Plank to pike walks", reps: "3 √ó 4-8", inApp: true, mins: 3 }]},
  12: { focus: "Arms", exercises: [{ name: "Banded bicep curls", reps: "3 √ó 6-12", inApp: true, mins: 3 }, { name: "Floor tricep extension", reps: "3 √ó 5-10", inApp: true, mins: 3 }]},
  13: { focus: "Abs/Core", exercises: [{ name: "Hollow body hold", reps: "3 √ó 20-45 sec", inApp: true, mins: 3 }, { name: "Superman hold", reps: "3 √ó 30-60 sec", inApp: true, mins: 3 }]},
  14: { focus: "Mobility", exercises: [{ name: "Pigeon pose stretch (left)", reps: "3 √ó 15-30 sec", inApp: true, mins: 2 }, { name: "Pigeon pose stretch (right)", reps: "3 √ó 15-30 sec", inApp: true, mins: 2 }, { name: "Camel pose", reps: "3 √ó 20-40 sec", inApp: true, mins: 2 }]}
};

const trainingData = {
  gymDay1: {
    title: "üèãÔ∏è GYM Day 1", time: "~85 min",
    sections: [
      { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true },
      { name: "Quick Prep at Home (5 min)", exercises: [{ name: "Bridges", reps: "1 √ó 10", mins: 2 }, { name: "Inchworms", reps: "1 √ó 8", mins: 2 }, { name: "Arm circles", reps: "20 each way", mins: 1 }]},
      { name: "Travel (10 min)", exercises: [{ name: "Walk or jog to gym", reps: "", mins: 10 }] },
      { name: "Cardio (20 min)", exercises: [{ name: "Skipping", reps: "5 min", mins: 5 }, { name: "Machine cardio (rotate)", reps: "15 min Zone 2", mins: 15 }]},
      { name: "Strength - 2-2-2 Method", exercises: [
        { name: "Leg Press", reps: "2 √ó 6-8", trackWeight: true, mins: 4 },
        { name: "Converging Chest Press", reps: "2 √ó 6-10", trackWeight: true, mins: 4 },
        { name: "Lat Pulldown", reps: "2 √ó 6-10", trackWeight: true, mins: 4 },
        { name: "Barbell Romanian Deadlift", reps: "2 √ó 6-10", trackWeight: true, mins: 4 },
        { name: "Cable Lateral Raise", reps: "2 √ó 10-12", trackWeight: true, mins: 3 },
        { name: "Incline Dumbbell Curl", reps: "2 √ó 8-12", trackWeight: true, mins: 3 },
        { name: "Reverse Pec Deck", reps: "2 √ó 10-12", trackWeight: true, mins: 3 }
      ]},
      { name: "Core", exercises: [{ name: "Cable Crunches", reps: "2 √ó 12-15", trackWeight: true, mins: 3 }, { name: "Cable Woodchops", reps: "2 √ó 10 each", trackWeight: true, mins: 3 }]},
      { name: "Travel Home (10 min)", exercises: [{ name: "Walk or jog", reps: "", mins: 10 }] },
      { name: "Isometrics at Home (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4√ó2min / 4√ó2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2√ó30s ea / 1√ó45s", mins: 2 }]},
      { name: "Close at Home (5 min)", exercises: [{ name: "Active hang", reps: "1 √ó max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 √ó 20 sec", mins: 1 }, { name: "Scapula dips", reps: "1 √ó 10", mins: 1 }]}
    ]
  },
  gymDay2: {
    title: "üèãÔ∏è GYM Day 2", time: "~85 min",
    sections: [
      { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true },
      { name: "Quick Prep at Home (5 min)", exercises: [{ name: "Bridges", reps: "1 √ó 10", mins: 2 }, { name: "Inchworms", reps: "1 √ó 8", mins: 2 }, { name: "Arm circles", reps: "20 each way", mins: 1 }]},
      { name: "Travel (10 min)", exercises: [{ name: "Walk or jog to gym", reps: "", mins: 10 }] },
      { name: "Cardio (20 min)", exercises: [{ name: "Skipping", reps: "5 min", mins: 5 }, { name: "Machine cardio (rotate)", reps: "15 min Zone 2", mins: 15 }]},
      { name: "Strength - 2-2-2 Method", exercises: [
        { name: "Chest-Supported Row", reps: "2 √ó 6-10", trackWeight: true, mins: 4 },
        { name: "Incline Dumbbell Press", reps: "2 √ó 6-10", trackWeight: true, mins: 4 },
        { name: "Barbell Hip Thrust", reps: "2 √ó 6-10", trackWeight: true, mins: 4 },
        { name: "Bulgarian Split Squat", reps: "2 √ó 6-10", trackWeight: true, mins: 5 },
        { name: "Cable Lateral Raise", reps: "2 √ó 10-12", trackWeight: true, mins: 3 },
        { name: "Barbell Skull Crusher", reps: "2 √ó 8-12", trackWeight: true, mins: 3 },
        { name: "High Incline Shrugs", reps: "2 √ó 8-12", trackWeight: true, mins: 3 }
      ]},
      { name: "Core", exercises: [{ name: "Cable Crunches", reps: "2 √ó 12-15", trackWeight: true, mins: 3 }, { name: "Cable Woodchops", reps: "2 √ó 10 each", trackWeight: true, mins: 3 }]},
      { name: "Travel Home (10 min)", exercises: [{ name: "Walk or jog", reps: "", mins: 10 }] },
      { name: "Isometrics at Home (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4√ó2min / 4√ó2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2√ó30s ea / 1√ó45s", mins: 2 }]},
      { name: "Close at Home (5 min)", exercises: [{ name: "Active hang", reps: "1 √ó max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 √ó 20 sec", mins: 1 }, { name: "Scapula dips", reps: "1 √ó 10", mins: 1 }]}
    ]
  },
  gymRecoveryWeekend: {
    title: "üèãÔ∏è GYM Recovery WEEKEND", time: "~110 min",
    sections: [
      { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true },
      { name: "Travel (10 min)", exercises: [{ name: "Walk or jog to gym", reps: "", mins: 10 }] },
      { name: "Warm-up (10 min)", exercises: [{ name: "Bridges", reps: "1 √ó 10", mins: 2 }, { name: "Inchworms", reps: "1 √ó 8", mins: 2 }, { name: "Shoulder dislocates", reps: "1 √ó 10", mins: 1 }, { name: "Broomstick good morning", reps: "1 √ó 10", mins: 1 }, { name: "Broomstick squat", reps: "1 √ó 10", mins: 1 }, { name: "Bend mobility flow", reps: "5 min", inApp: true, mins: 5 }]},
      { name: "Cardio (30 min)", exercises: [{ name: "Incline walk", reps: "15 min Zone 2", mins: 15 }, { name: "Machine cardio (rotate)", reps: "15 min Zone 2", mins: 15 }]},
      { name: "Scapula Work", exercises: [{ name: "Scapula dips", reps: "2 √ó 10", mins: 2 }, { name: "Scapula press-ups", reps: "2 √ó 10", mins: 2 }, { name: "Scapula pull-downs", reps: "2 √ó 10", mins: 2 }, { name: "Scapula pull-ups", reps: "2 √ó 5", mins: 2 }]},
      { name: "Core", exercises: [{ name: "Cable crunches", reps: "2 √ó 12-15", trackWeight: true, mins: 3 }, { name: "Cable woodchops", reps: "2 √ó 10 each", trackWeight: true, mins: 3 }, { name: "Side plank (left)", reps: "1 √ó 30 sec", mins: 1 }, { name: "Side plank (right)", reps: "1 √ó 30 sec", mins: 1 }, { name: "Russian twists", reps: "2 √ó 10 each", mins: 2 }]},
      { name: "Glutes/Hips", exercises: [{ name: "Hip abductor machine", reps: "2 √ó 15", trackWeight: true, mins: 3 }, { name: "Hip adductor machine", reps: "2 √ó 15", trackWeight: true, mins: 3 }, { name: "Cable pull-throughs", reps: "2 √ó 12", trackWeight: true, mins: 3 }]},
      { name: "Isometrics", exercises: [{ name: "Wall sit", reps: "2 √ó 2 min", mins: 5 }] },
      { name: "Strength", exercises: [{ name: "Turkish get-up (left)", reps: "1 rep", trackWeight: true, mins: 3 }, { name: "Turkish get-up (right)", reps: "1 rep", trackWeight: true, mins: 3 }]},
      { name: "Close", exercises: [{ name: "Active hang", reps: "1 √ó max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 √ó 20 sec", mins: 1 }]},
      { name: "Stretch", exercises: [{ name: "Hip flexor stretch (left)", reps: "2 min", mins: 2 }, { name: "Hip flexor stretch (right)", reps: "2 min", mins: 2 }, { name: "Figure 4 stretch (left)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Figure 4 stretch (right)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Side-lying quad stretch (left)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Side-lying quad stretch (right)", reps: "1 √ó 60 sec", mins: 1 }]},
      { name: "Travel Home (10 min)", exercises: [{ name: "Walk or jog", reps: "", mins: 10 }] }
    ]
  },
  gymRecoveryWeekday: {
    title: "üèãÔ∏è GYM Recovery WEEKDAY", time: "~80 min",
    sections: [
      { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true },
      { name: "Travel (10 min)", exercises: [{ name: "Walk or jog to gym", reps: "", mins: 10 }] },
      { name: "Warm-up", exercises: [{ name: "Bridges", reps: "1 √ó 10", mins: 2 }, { name: "Inchworms", reps: "1 √ó 8", mins: 2 }]},
      { name: "Cardio (25 min)", exercises: [{ name: "Incline walk", reps: "15 min Zone 2", mins: 15 }, { name: "Machine cardio (rotate)", reps: "10 min Zone 2", mins: 10 }]},
      { name: "Core", exercises: [{ name: "Cable crunches", reps: "2 √ó 12-15", trackWeight: true, mins: 3 }, { name: "Cable woodchops", reps: "2 √ó 10 each", trackWeight: true, mins: 3 }]},
      { name: "Glutes/Hips", exercises: [{ name: "Hip abductor machine", reps: "2 √ó 15", trackWeight: true, mins: 3 }, { name: "Hip adductor machine", reps: "2 √ó 15", trackWeight: true, mins: 3 }]},
      { name: "Isometrics", exercises: [{ name: "Wall sit", reps: "2 √ó 2 min", mins: 5 }] },
      { name: "Close", exercises: [{ name: "Active hang", reps: "1 √ó max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 √ó 20 sec", mins: 1 }]},
      { name: "Travel Home (10 min)", exercises: [{ name: "Walk or jog", reps: "", mins: 10 }] }
    ]
  },
  homeFull: {
    title: "üè† HOME Full", time: "~70-80 min",
    sections: [
      { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true },
      { name: "OPEN (10 min)", exercises: [{ name: "Bridges", reps: "1 √ó 10", mins: 2 }, { name: "Inchworms", reps: "1 √ó 8", mins: 2 }, { name: "Shoulder dislocates", reps: "1 √ó 10", mins: 1 }, { name: "Broomstick good morning", reps: "1 √ó 10", mins: 1 }, { name: "Broomstick squat", reps: "1 √ó 10", mins: 1 }, { name: "Bend mobility flow", reps: "5 min", inApp: true, mins: 5 }]},
      { name: "BUILD - Glutes & Physio (A/B)", isConditionalGlutes: true, exercises: [
        { name: "A: Clamshells / B: Banded walks", reps: "1√ó15 ea / 1√ó20", mins: 2 },
        { name: "A: Fire hydrants / B: SL glute bridge", reps: "1√ó15 ea / 1√ó10 ea", mins: 2 },
        { name: "A: Glute bridges / B: Donkey kicks", reps: "1√ó15 / 1√ó15 ea", mins: 2 },
        { name: "Sidestep miniband", reps: "2 √ó 20 steps", mins: 2 },
        { name: "Isometric ball extension (left)", reps: "3 √ó 30 sec", mins: 2 },
        { name: "Isometric ball extension (right)", reps: "3 √ó 30 sec", mins: 2 },
        { name: "Swiss ball leg curl (both)", reps: "2 √ó 10", mins: 2 },
        { name: "Swiss ball leg curl (left)", reps: "1 √ó 8", mins: 1 },
        { name: "Swiss ball leg curl (right)", reps: "1 √ó 8", mins: 1 },
        { name: "Single leg hip thrust (left)", reps: "1 √ó 10", mins: 1 },
        { name: "Single leg hip thrust (right)", reps: "1 √ó 10", mins: 1 },
        { name: "DB single leg RDL (left)", reps: "1 √ó 8", trackWeight: true, mins: 2 },
        { name: "DB single leg RDL (right)", reps: "1 √ó 8", trackWeight: true, mins: 2 }
      ]},
      { name: "BUILD - Isometrics (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4√ó2min / 4√ó2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2√ó30s ea / 1√ó45s", mins: 2 }]},
      { name: "BUILD - Main", exercises: [
        { name: "KB swings", reps: "2 √ó 20", trackWeight: true, mins: 4 },
        { name: "Turkish get-up (left)", reps: "1 rep", trackWeight: true, isConditionalTGU: true, mins: 3 },
        { name: "Turkish get-up (right)", reps: "1 rep", trackWeight: true, isConditionalTGU: true, mins: 3 },
        { name: "Parallette dips", reps: "2 √ó 8", mins: 3 },
        { name: "Punch bag", reps: "5 min", mins: 5 }
      ]},
      { name: "BUILD - Core", exercises: [{ name: "Leg raises", reps: "2 √ó 10", mins: 2 }, { name: "Side plank (left)", reps: "1 √ó 30 sec", mins: 1 }, { name: "Side plank (right)", reps: "1 √ó 30 sec", mins: 1 }, { name: "Russian twists (KB)", reps: "2 √ó 10 each", trackWeight: true, mins: 2 }]},
      { name: "CLOSE - Stretch", exercises: [{ name: "Figure 4 stretch (left)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Figure 4 stretch (right)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Side-lying quad stretch (left)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Side-lying quad stretch (right)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Active hang", reps: "1 √ó max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 √ó 20 sec", mins: 1 }]}
    ]
  },
  homeLight: {
    title: "üè† HOME Light", time: "~60 min",
    sections: [
      { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true },
      { name: "OPEN (10 min)", exercises: [{ name: "Bridges", reps: "1 √ó 10", mins: 2 }, { name: "Inchworms", reps: "1 √ó 8", mins: 2 }, { name: "Bend mobility flow", reps: "5 min", inApp: true, mins: 5 }]},
      { name: "MAINTAIN - Glutes & Physio (A/B)", exercises: [
        { name: "A: Clamshells / B: Banded walks", reps: "1√ó15 ea / 1√ó20", mins: 2 },
        { name: "A: Fire hydrants / B: SL glute bridge", reps: "1√ó15 ea / 1√ó10 ea", mins: 2 },
        { name: "A: Glute bridges / B: Donkey kicks", reps: "1√ó15 / 1√ó15 ea", mins: 2 },
        { name: "Sidestep miniband", reps: "2 √ó 20 steps", mins: 2 },
        { name: "Isometric ball extension (left)", reps: "3 √ó 30 sec", mins: 2 },
        { name: "Isometric ball extension (right)", reps: "3 √ó 30 sec", mins: 2 },
        { name: "Swiss ball leg curl (both)", reps: "2 √ó 10", mins: 2 },
        { name: "Swiss ball leg curl (left)", reps: "1 √ó 8", mins: 1 },
        { name: "Swiss ball leg curl (right)", reps: "1 √ó 8", mins: 1 },
        { name: "Single leg hip thrust (left)", reps: "1 √ó 10", mins: 1 },
        { name: "Single leg hip thrust (right)", reps: "1 √ó 10", mins: 1 },
        { name: "DB single leg RDL (left)", reps: "1 √ó 8", trackWeight: true, mins: 2 },
        { name: "DB single leg RDL (right)", reps: "1 √ó 8", trackWeight: true, mins: 2 }
      ]},
      { name: "MAINTAIN - Main", exercises: [{ name: "KB swings", reps: "2 √ó 20", trackWeight: true, mins: 4 }, { name: "Parallette dips", reps: "2 √ó 8", mins: 3 }]},
      { name: "Isometrics (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4√ó2min / 4√ó2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2√ó30s ea / 1√ó45s", mins: 2 }]},
      { name: "CLOSE - Stretch", exercises: [{ name: "Figure 4 stretch (left)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Figure 4 stretch (right)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Side-lying quad stretch (left)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Side-lying quad stretch (right)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Active hang", reps: "1 √ó max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 √ó 20 sec", mins: 1 }]}
    ]
  },
  rest: {
    title: "üò¥ REST Day", time: "~70 min",
    sections: [
      { name: "Calisthenics (10 min)", exercises: [], isCalisthenics: true },
      { name: "Warm-up", exercises: [{ name: "Bridges", reps: "1 √ó 10", mins: 2 }, { name: "Inchworms", reps: "1 √ó 8", mins: 2 }]},
      { name: "Recovery", exercises: [{ name: "Bend mobility flow", reps: "15 min", inApp: true, mins: 15 }] },
      { name: "Glutes & Physio (A/B)", exercises: [
        { name: "A: Clamshells / B: Banded walks", reps: "1√ó15 ea / 1√ó20", mins: 2 },
        { name: "A: Fire hydrants / B: SL glute bridge", reps: "1√ó15 ea / 1√ó10 ea", mins: 2 },
        { name: "A: Glute bridges / B: Donkey kicks", reps: "1√ó15 / 1√ó15 ea", mins: 2 },
        { name: "Sidestep miniband", reps: "2 √ó 20 steps", mins: 2 },
        { name: "Isometric ball extension (left)", reps: "3 √ó 30 sec", mins: 2 },
        { name: "Isometric ball extension (right)", reps: "3 √ó 30 sec", mins: 2 },
        { name: "Swiss ball leg curl (both)", reps: "2 √ó 10", mins: 2 },
        { name: "Swiss ball leg curl (left)", reps: "1 √ó 8", mins: 1 },
        { name: "Swiss ball leg curl (right)", reps: "1 √ó 8", mins: 1 },
        { name: "Single leg hip thrust (left)", reps: "1 √ó 10", mins: 1 },
        { name: "Single leg hip thrust (right)", reps: "1 √ó 10", mins: 1 },
        { name: "DB single leg RDL (left)", reps: "1 √ó 8", trackWeight: true, mins: 2 },
        { name: "DB single leg RDL (right)", reps: "1 √ó 8", trackWeight: true, mins: 2 }
      ]},
      { name: "Isometrics (A/B)", exercises: [{ name: "A: Wall sit / B: Handgrip", reps: "4√ó2min / 4√ó2min ea", mins: 9 }, { name: "A: SL wall sit / B: Plank", reps: "2√ó30s ea / 1√ó45s", mins: 2 }]},
      { name: "CLOSE - Stretch", exercises: [{ name: "Figure 4 stretch (left)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Figure 4 stretch (right)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Side-lying quad stretch (left)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Side-lying quad stretch (right)", reps: "1 √ó 60 sec", mins: 1 }, { name: "Active hang", reps: "1 √ó max", trackTime: true, mins: 2 }, { name: "Passive hang", reps: "1 √ó 20 sec", mins: 1 }]}
    ]
  }
};

const dailyNonNegotiables = [
  { name: "30-min power walk", reps: "", mins: 30 },
  { name: "5-min breathing (5s in, 5s out)", reps: "", mins: 5 },
  { name: "Vagus: Cold shower / Humming / Gargling", reps: "", mins: 2 }
];

const VideoLink = ({ name }) => {
  const url = videoLinks[name];
  if (!url) return null;
  return <a href={url} target="_blank" rel="noopener noreferrer" className="text-blue-500 hover:text-blue-700 ml-1" onClick={(e) => e.stopPropagation()}>üìπ</a>;
};

const AppBadge = () => <span className="text-green-600 text-xs ml-1">üì±</span>;

// Stopwatch Component
const Stopwatch = ({ dayData, setDayData, expectedMins }) => {
  const [displayTime, setDisplayTime] = useState(0);
  const intervalRef = useRef(null);
  
  const isRunning = dayData.stopwatchRunning || false;
  const accumulatedTime = dayData.stopwatchTime || 0;
  const startTimestamp = dayData.stopwatchStart || null;
  
  useEffect(() => {
    if (isRunning && startTimestamp) {
      intervalRef.current = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTimestamp) / 1000);
        setDisplayTime(accumulatedTime + elapsed);
      }, 1000);
    } else {
      setDisplayTime(accumulatedTime);
    }
    return () => clearInterval(intervalRef.current);
  }, [isRunning, startTimestamp, accumulatedTime]);
  
  const startTimer = () => {
    setDayData({
      ...dayData,
      stopwatchRunning: true,
      stopwatchStart: Date.now()
    });
  };
  
  const pauseTimer = () => {
    const elapsed = startTimestamp ? Math.floor((Date.now() - startTimestamp) / 1000) : 0;
    setDayData({
      ...dayData,
      stopwatchRunning: false,
      stopwatchTime: accumulatedTime + elapsed,
      stopwatchStart: null
    });
  };
  
  const resetTimer = () => {
    setDayData({
      ...dayData,
      stopwatchRunning: false,
      stopwatchTime: 0,
      stopwatchStart: null
    });
  };
  
  const formatTime = (seconds) => {
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    if (hrs > 0) {
      return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };
  
  const actualMins = Math.floor(displayTime / 60);
  const diffMins = actualMins - expectedMins;
  const diffText = diffMins === 0 ? 'on target' : diffMins > 0 ? `+${diffMins}m over` : `${Math.abs(diffMins)}m under`;
  const diffColor = diffMins <= 0 ? 'text-green-600' : 'text-orange-500';
  
  return (
    <div className="mb-3 bg-gray-800 text-white rounded-lg p-3">
      <div className="flex items-center justify-between">
        <div>
          <div className="text-3xl font-mono font-bold">{formatTime(displayTime)}</div>
          <div className={`text-xs ${diffColor}`}>Expected ~{expectedMins}m ‚Ä¢ {diffText}</div>
        </div>
        <div className="flex gap-2">
          {!isRunning ? (
            <button onClick={startTimer} className="px-4 py-2 bg-green-500 rounded-lg font-bold">‚ñ∂</button>
          ) : (
            <button onClick={pauseTimer} className="px-4 py-2 bg-yellow-500 rounded-lg font-bold">‚è∏</button>
          )}
          <button onClick={resetTimer} className="px-3 py-2 bg-gray-600 rounded-lg text-sm">‚Ü∫</button>
        </div>
      </div>
    </div>
  );
};

const Section = ({ section, sectionIndex, dayData, setDayData, cycleDay, cardioMachine, showGlutes, showTGU }) => {
  const [isOpen, setIsOpen] = useState(true);
  if (section.isConditionalGlutes && !showGlutes) return null;
  
  let exercises = section.exercises;
  if (section.isCalisthenics && cycleDay) {
    const calData = calisthenicsRotation[cycleDay];
    exercises = calData ? calData.exercises : [];
  }
  exercises = exercises.filter(ex => !ex.isConditionalTGU || showTGU);
  if (exercises.length === 0 && !section.isCalisthenics) return null;
  
  const checks = dayData.checks || {};
  const weights = dayData.weights || {};
  const allChecked = exercises.length > 0 && exercises.every((_, i) => checks[`${sectionIndex}-${i}`]);

  const toggleCheck = (i) => {
    const key = `${sectionIndex}-${i}`;
    setDayData({ ...dayData, checks: { ...checks, [key]: !checks[key] } });
  };

  const updateWeight = (i, value) => {
    const key = `${sectionIndex}-${i}`;
    setDayData({ ...dayData, weights: { ...weights, [key]: value } });
  };

  const sectionTitle = section.isCalisthenics && cycleDay 
    ? `üèÉ Calisthenics Day ${cycleDay}: ${calisthenicsRotation[cycleDay]?.focus}`
    : section.name;

  return (
    <div className="mb-2 border border-gray-200 rounded-lg overflow-hidden">
      <button onClick={() => setIsOpen(!isOpen)} className={`w-full p-2 flex items-center justify-between text-left text-sm font-medium ${allChecked ? 'bg-green-100 text-green-800' : section.isCalisthenics ? 'bg-purple-50' : 'bg-gray-50'}`}>
        <div className="flex items-center gap-2">
          {isOpen ? '‚ñº' : '‚ñ∂'} <span>{sectionTitle}</span>
          {section.isCalisthenics && <span className="text-green-600 text-xs">üì± in app</span>}
        </div>
        {allChecked && <span className="text-green-600">‚úì</span>}
      </button>
      {isOpen && (
        <div className="p-2 bg-white">
          {exercises.map((exercise, i) => {
            const checkKey = `${sectionIndex}-${i}`;
            const isChecked = checks[checkKey] || false;
            const weight = weights[checkKey] || '';
            return (
              <div key={i} className={`flex items-center gap-2 p-2 rounded ${isChecked ? 'bg-green-50' : ''}`}>
                <input type="checkbox" checked={isChecked} onChange={() => toggleCheck(i)} className="w-5 h-5 rounded flex-shrink-0" />
                <div className="flex-1 min-w-0">
                  <div className={`text-sm flex items-center ${isChecked ? 'line-through text-gray-400' : ''}`}>
                    {exercise.name === "Machine cardio (rotate)" ? cardioMachine : exercise.name}
                    {videoLinks[exercise.name] && <VideoLink name={exercise.name} />}
                    {exercise.inApp && <AppBadge />}
                  </div>
                  <div className={`text-xs ${isChecked ? 'text-gray-300' : 'text-gray-500'}`}>{exercise.reps}</div>
                </div>
                {(exercise.trackWeight || exercise.trackTime) && (
                  <input type="text" placeholder={exercise.trackWeight ? "kg" : "sec"} value={weight} onChange={(e) => updateWeight(i, e.target.value)} className="w-14 px-2 py-1 text-xs border rounded text-center" />
                )}
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
};

const BugsSection = ({ cycleDay, bugs, setBugs }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [newBug, setNewBug] = useState('');
  
  const cycleBugs = bugs[cycleDay] || [];
  const openBugs = cycleBugs.filter(b => !b.fixed);
  const fixedBugs = cycleBugs.filter(b => b.fixed);
  
  const addBug = () => {
    if (!newBug.trim()) return;
    const updated = {
      ...bugs,
      [cycleDay]: [...cycleBugs, { id: Date.now(), text: newBug.trim(), fixed: false, dateAdded: new Date().toISOString() }]
    };
    setBugs(updated);
    setNewBug('');
  };
  
  const toggleBug = (bugId) => {
    const updated = {
      ...bugs,
      [cycleDay]: cycleBugs.map(b => b.id === bugId ? { ...b, fixed: !b.fixed } : b)
    };
    setBugs(updated);
  };
  
  const deleteBug = (bugId) => {
    const updated = {
      ...bugs,
      [cycleDay]: cycleBugs.filter(b => b.id !== bugId)
    };
    setBugs(updated);
  };
  
  return (
    <div className="mb-3 border-2 border-orange-200 rounded-lg overflow-hidden">
      <button onClick={() => setIsOpen(!isOpen)} className="w-full bg-orange-100 p-2 font-bold text-orange-800 text-sm flex justify-between items-center">
        <span>üêõ Bugs for Day {cycleDay} ({openBugs.length} open)</span>
        <span>{isOpen ? '‚ñº' : '‚ñ∂'}</span>
      </button>
      {isOpen && (
        <div className="p-2 bg-white">
          <div className="flex gap-2 mb-2">
            <input type="text" value={newBug} onChange={(e) => setNewBug(e.target.value)} placeholder="Describe bug..." className="flex-1 px-2 py-1 text-sm border rounded" onKeyPress={(e) => e.key === 'Enter' && addBug()} />
            <button onClick={addBug} className="px-3 py-1 bg-orange-500 text-white rounded text-sm">Add</button>
          </div>
          {openBugs.length > 0 && (
            <div className="mb-2">
              <div className="text-xs text-gray-500 mb-1">Open:</div>
              {openBugs.map(bug => (
                <div key={bug.id} className="flex items-center gap-2 p-2 bg-orange-50 rounded mb-1">
                  <input type="checkbox" checked={false} onChange={() => toggleBug(bug.id)} className="w-4 h-4" />
                  <span className="flex-1 text-sm">{bug.text}</span>
                  <button onClick={() => deleteBug(bug.id)} className="text-red-400 text-xs">‚úï</button>
                </div>
              ))}
            </div>
          )}
          {fixedBugs.length > 0 && (
            <div>
              <div className="text-xs text-gray-500 mb-1">Fixed:</div>
              {fixedBugs.map(bug => (
                <div key={bug.id} className="flex items-center gap-2 p-2 bg-green-50 rounded mb-1">
                  <input type="checkbox" checked={true} onChange={() => toggleBug(bug.id)} className="w-4 h-4" />
                  <span className="flex-1 text-sm line-through text-gray-400">{bug.text}</span>
                  <button onClick={() => deleteBug(bug.id)} className="text-red-400 text-xs">‚úï</button>
                </div>
              ))}
            </div>
          )}
          {cycleBugs.length === 0 && <div className="text-xs text-gray-400 text-center py-2">No bugs for this day.</div>}
          <div className="text-xs text-gray-400 mt-2 text-center">Bugs cycle every 14 days with your routine.</div>
        </div>
      )}
    </div>
  );
};

function TrainingApp() {
  const [selectedDate, setSelectedDate] = useState(formatDate(new Date()));
  const [allData, setAllData] = useState({});
  const [bugs, setBugs] = useState({});
  const [view, setView] = useState('today');
  const [loading, setLoading] = useState(true);

  const currentDate = parseDate(selectedDate);
  const session = getSession(currentDate);
  const sessionData = trainingData[session];
  const cycleDay = getCycleDay(currentDate);
  const weekNum = getWeekNumber(currentDate);
  const weekType = getWeekType(currentDate);
  const custody = getCustody(currentDate);
  const cardioMachine = getCardioMachine(currentDate);
  const showGlutes = getShowGlutes(currentDate);
  const showTGU = getShowTGU(currentDate);
  const dayData = allData[selectedDate] || { checks: {}, weights: {} };

  useEffect(() => {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) setAllData(JSON.parse(saved));
      const savedBugs = localStorage.getItem(BUGS_KEY);
      if (savedBugs) setBugs(JSON.parse(savedBugs));
    } catch (e) { console.log('No saved data'); }
    setLoading(false);
  }, []);

  useEffect(() => {
    if (!loading) {
      try { 
        localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
        localStorage.setItem(BUGS_KEY, JSON.stringify(bugs));
      } catch (e) { console.log('Could not save'); }
    }
  }, [allData, bugs, loading]);

  const setDayData = (newDayData) => setAllData({ ...allData, [selectedDate]: newDayData });

  const navigateDay = (delta) => {
    const newDate = new Date(currentDate);
    newDate.setDate(newDate.getDate() + delta);
    if (newDate >= PROGRAM_START && newDate <= PROGRAM_END) setSelectedDate(formatDate(newDate));
  };

  const resetDay = () => setDayData({ checks: {}, weights: {}, stopwatchTime: 0, stopwatchRunning: false, stopwatchStart: null });

  const getProgress = () => {
    const checks = dayData.checks || {};
    let totalMins = 0;
    let doneMins = 0;
    dailyNonNegotiables.forEach((item, i) => {
      totalMins += item.mins;
      if (checks[`daily-${i}`]) doneMins += item.mins;
    });
    sessionData.sections.forEach((section, si) => {
      if (section.isConditionalGlutes && !showGlutes) return;
      let exercises = section.exercises;
      if (section.isCalisthenics) exercises = calisthenicsRotation[cycleDay]?.exercises || [];
      exercises = exercises.filter(ex => !ex.isConditionalTGU || showTGU);
      exercises.forEach((ex, ei) => {
        const mins = ex.mins || 2;
        totalMins += mins;
        if (checks[`${si}-${ei}`]) doneMins += mins;
      });
    });
    return totalMins > 0 ? Math.round((doneMins / totalMins) * 100) : 0;
  };

  const getTotalTime = () => {
    let totalMins = 0;
    dailyNonNegotiables.forEach(item => totalMins += item.mins);
    sessionData.sections.forEach(section => {
      if (section.isConditionalGlutes && !showGlutes) return;
      let exercises = section.exercises;
      if (section.isCalisthenics) exercises = calisthenicsRotation[cycleDay]?.exercises || [];
      exercises = exercises.filter(ex => !ex.isConditionalTGU || showTGU);
      exercises.forEach(ex => totalMins += ex.mins || 2);
    });
    return totalMins;
  };

  const formatDisplayDate = (date) => date.toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric', month: 'short' });

  const getExerciseHistory = (exerciseName) => {
    const history = [];
    Object.entries(allData).forEach(([date, data]) => {
      if (data.weights) {
        Object.entries(data.weights).forEach(([key, value]) => {
          if (value) {
            const sessionType = getSession(parseDate(date));
            const sessionInfo = trainingData[sessionType];
            sessionInfo.sections.forEach((section, si) => {
              section.exercises.forEach((ex, ei) => {
                if (`${si}-${ei}` === key && ex.name === exerciseName) history.push({ date, weight: value });
              });
            });
          }
        });
      }
    });
    return history.sort((a, b) => a.date.localeCompare(b.date));
  };

  if (loading) return <div className="p-4 text-center">Loading...</div>;

  const totalTime = getTotalTime();
  const openBugsCount = (bugs[cycleDay] || []).filter(b => !b.fixed).length;

  return (
    <div className="min-h-screen bg-gray-100 pb-20">
      <div className="bg-blue-600 text-white p-3 sticky top-0 z-10">
        <div className="flex justify-between items-center">
          <div>
            <div className="text-lg font-bold">Week {weekNum} of 25</div>
            <div className="text-xs opacity-80">Week {weekType} ‚Ä¢ Target: 85kg by Jul 12</div>
          </div>
          <div className="text-right">
            <div className="text-2xl font-bold">{getProgress()}%</div>
            <div className="text-xs opacity-80">~{totalTime} min today</div>
          </div>
        </div>
        <div className="flex items-center justify-between mt-3 bg-blue-500 rounded-lg p-2">
          <button onClick={() => navigateDay(-1)} className="p-1 text-xl">‚óÄ</button>
          <div className="text-center">
            <div className="font-bold">{formatDisplayDate(currentDate)}</div>
            <div className="text-xs opacity-80">{custody} ‚Ä¢ Day {cycleDay}/14 {openBugsCount > 0 && `‚Ä¢ üêõ${openBugsCount}`}</div>
          </div>
          <button onClick={() => navigateDay(1)} className="p-1 text-xl">‚ñ∂</button>
        </div>
      </div>

      <div className="bg-white border-b flex text-xs">
        {[{ id: 'today', icon: 'üìã', label: 'Today' }, { id: 'calendar', icon: 'üìÖ', label: 'Calendar' }, { id: 'progress', icon: 'üìà', label: 'Progress' }, { id: 'info', icon: '‚ÑπÔ∏è', label: 'Info' }].map(tab => (
          <button key={tab.id} onClick={() => setView(tab.id)} className={`flex-1 p-2 text-center font-medium ${view === tab.id ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'}`}>
            {tab.icon} {tab.label}
          </button>
        ))}
      </div>

      {view === 'today' ? (
        <div className="p-3">
          <div className="flex justify-between items-center mb-3">
            <div>
              <h2 className="font-bold">{sessionData.title}</h2>
              <p className="text-xs text-gray-500">{sessionData.time}</p>
              <p className="text-xs text-purple-600">Cal Day {cycleDay}: {calisthenicsRotation[cycleDay]?.focus}</p>
            </div>
            <button onClick={resetDay} className="p-2 text-gray-400">üîÑ</button>
          </div>

          <Stopwatch dayData={dayData} setDayData={setDayData} expectedMins={totalTime} />

          <div className="mb-3 p-2 bg-gray-50 rounded text-xs flex gap-4">
            <span>üìπ = YouTube</span>
            <span>üì± = In app</span>
          </div>

          <BugsSection cycleDay={cycleDay} bugs={bugs} setBugs={setBugs} />

          <div className="mb-3 border-2 border-blue-200 rounded-lg overflow-hidden">
            <div className="bg-blue-100 p-2 font-bold text-blue-800 text-sm">üìå Daily Non-Negotiables</div>
            <div className="p-2 bg-white">
              {dailyNonNegotiables.map((item, i) => {
                const key = `daily-${i}`;
                const isChecked = (dayData.checks || {})[key];
                return (
                  <label key={i} className={`flex items-center gap-2 p-2 rounded ${isChecked ? 'bg-green-50' : ''}`}>
                    <input type="checkbox" checked={isChecked || false} onChange={() => setDayData({ ...dayData, checks: { ...(dayData.checks || {}), [key]: !isChecked } })} className="w-5 h-5 rounded" />
                    <span className={`text-sm flex-1 ${isChecked ? 'line-through text-gray-400' : ''}`}>{item.name}</span>
                    <span className="text-xs text-gray-400">{item.mins}m</span>
                  </label>
                );
              })}
            </div>
          </div>

          {sessionData.sections.map((section, i) => (
            <Section key={i} section={section} sectionIndex={i} dayData={dayData} setDayData={setDayData} cycleDay={cycleDay} cardioMachine={cardioMachine} showGlutes={showGlutes} showTGU={showTGU} />
          ))}
        </div>
      ) : view === 'calendar' ? (
        <div className="p-3">
          <h2 className="font-bold mb-3">Jump to Date</h2>
          <div className="grid grid-cols-7 gap-1 text-xs">
            {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((d, i) => <div key={i} className="text-center font-bold text-gray-500 p-1">{d}</div>)}
            {(() => {
              const days = [];
              const current = new Date(PROGRAM_START);
              for (let i = 0; i < current.getDay(); i++) days.push(<div key={`empty-${i}`} className="p-1" />);
              while (current <= PROGRAM_END) {
                const dateStr = formatDate(current);
                const hasData = allData[dateStr] && Object.keys(allData[dateStr].checks || {}).length > 0;
                const isSelected = dateStr === selectedDate;
                const dayCycle = getCycleDay(current);
                const hasBugs = (bugs[dayCycle] || []).filter(b => !b.fixed).length > 0;
                days.push(
                  <button key={dateStr} onClick={() => { setSelectedDate(dateStr); setView('today'); }} className={`p-1 text-center rounded relative ${isSelected ? 'bg-blue-600 text-white' : hasData ? 'bg-green-100 text-green-800' : 'bg-white'}`}>
                    {current.getDate()}
                    {hasBugs && <span className="absolute -top-1 -right-1 text-orange-500 text-xs">‚Ä¢</span>}
                  </button>
                );
                current.setDate(current.getDate() + 1);
              }
              return days;
            })()}
          </div>
          <div className="mt-4 flex gap-4 text-xs">
            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-green-100 rounded" /> Logged</div>
            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-blue-600 rounded" /> Selected</div>
            <div className="flex items-center gap-1"><span className="text-orange-500">‚Ä¢</span> Has bugs</div>
          </div>
        </div>
      ) : view === 'progress' ? (
        <div className="p-3">
          <h2 className="font-bold mb-3">üìà Weight Progress</h2>
          {['Leg Press', 'Converging Chest Press', 'Lat Pulldown', 'Barbell Romanian Deadlift', 'Chest-Supported Row', 'Incline Dumbbell Press', 'Barbell Hip Thrust', 'Bulgarian Split Squat', 'KB swings', 'Turkish get-up (left)'].map(exercise => {
            const history = getExerciseHistory(exercise);
            if (history.length === 0) return null;
            return (
              <div key={exercise} className="bg-white p-3 rounded-lg border mb-2">
                <h3 className="font-medium text-sm">{exercise}</h3>
                <div className="flex flex-wrap gap-2 mt-2">
                  {history.slice(-8).map((h, i) => (
                    <div key={i} className="text-xs bg-gray-100 px-2 py-1 rounded">
                      <div className="font-bold">{h.weight}kg</div>
                      <div className="text-gray-500">{h.date.slice(5)}</div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
          {Object.keys(allData).length === 0 && <div className="text-center text-gray-400 py-8">No data yet. Start logging!</div>}
        </div>
      ) : (
        <div className="p-3 space-y-3">
          <div className="bg-white rounded-lg p-3 border">
            <h3 className="font-bold text-sm mb-2">üìÖ Program: Jan 19 - Jul 12, 2026</h3>
            <p className="text-xs text-gray-600">25 weeks total</p>
          </div>
          <div className="bg-white rounded-lg p-3 border">
            <h3 className="font-bold text-sm mb-2">‚è±Ô∏è Stopwatch</h3>
            <p className="text-xs text-gray-600">Start/pause to track actual session time. Compares to expected duration. Persists if you close the app.</p>
          </div>
          <div className="bg-white rounded-lg p-3 border">
            <h3 className="font-bold text-sm mb-2">üêõ Bug Tracking</h3>
            <p className="text-xs text-gray-600">Bugs are linked to cycle day (1-14). Add bugs on any day and they appear again in 2 weeks on the same cycle day for verification.</p>
          </div>
          <div className="bg-white rounded-lg p-3 border">
            <h3 className="font-bold text-sm mb-2">‚è±Ô∏è Session Times</h3>
            <div className="text-xs space-y-1">
              <div className="flex justify-between"><span>GYM Day 1/2</span><span>~85 min</span></div>
              <div className="flex justify-between"><span>GYM Recovery Weekend</span><span>~110 min</span></div>
              <div className="flex justify-between"><span>GYM Recovery Weekday</span><span>~80 min</span></div>
              <div className="flex justify-between"><span>HOME Full</span><span>~70-80 min</span></div>
              <div className="flex justify-between"><span>HOME Light</span><span>~60 min</span></div>
              <div className="flex justify-between"><span>REST</span><span>~70 min</span></div>
            </div>
          </div>
          <div className="bg-white rounded-lg p-3 border">
            <h3 className="font-bold text-sm mb-2">üìπ Video Legend</h3>
            <p className="text-xs text-gray-600">üìπ = YouTube tutorial link</p>
            <p className="text-xs text-gray-600">üì± = Covered in Calisthenics Family or Bend app</p>
          </div>
          <div className="bg-white rounded-lg p-3 border">
            <h3 className="font-bold text-sm mb-2">üéØ 2RIR Rule</h3>
            <p className="text-xs text-gray-600">Stop when you could do 2 more reps.</p>
          </div>
          <div className="bg-yellow-50 rounded-lg p-3 border border-yellow-200">
            <h3 className="font-bold text-sm mb-2 text-yellow-800">Remember</h3>
            <ul className="text-xs text-yellow-700 space-y-1">
              <li>‚úì Good enough for now</li>
              <li>‚úì Stay the course</li>
              <li>‚úì Imperfection is not the enemy, distraction is</li>
            </ul>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<TrainingApp />, document.getElementById('root'));
  </script>
</body>
</html>
